{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 118, "column": 0}, "map": {"version":3,"sources":["file:///D:/MyBlog/LoveandJoy/src/app/api/footer-config/route.ts"],"sourcesContent":["import { NextResponse } from 'next/server';\r\nimport mysql from 'mysql2/promise';\r\n\r\n// 定义页脚配置类型\r\ninterface FooterConfig {\r\n  id?: number;\r\n  site_title: string;\r\n  site_description: string;\r\n  email: string;\r\n  phone: string;\r\n  address: string;\r\n  social_facebook: string;\r\n  social_twitter: string;\r\n  social_instagram: string;\r\n  social_github: string;\r\n  social_linkedin: string;\r\n  quick_links: any[];\r\n  background_color: string;\r\n  text_color: string;\r\n  link_color: string;\r\n  link_hover_color: string;\r\n  border_color: string;\r\n  font_size: string;\r\n  layout_columns: number;\r\n  show_social_media: boolean;\r\n  show_contact_info: boolean;\r\n  show_quick_links: boolean;\r\n  show_copyright: boolean;\r\n  copyright_text: string;\r\n  created_at?: Date;\r\n  updated_at?: Date;\r\n}\r\n\r\n// 定义数据库执行结果类型\r\ninterface InsertResult {\r\n  insertId: number;\r\n}\r\n\r\n// 创建数据库连接\r\nasync function createConnection() {\r\n  return mysql.createConnection({\r\n    host: 'localhost',\r\n    port: 3306,\r\n    user: 'root',\r\n    password: '123456',\r\n    database: 'yueblog'\r\n  });\r\n}\r\n\r\n// 获取页尾配置\r\nexport async function GET() {\r\n  try {\r\n    const connection = await createConnection();\r\n// 查询页脚配置\r\n    const [rows] = await connection.execute('SELECT * FROM footer_config ORDER BY id DESC LIMIT 1');\r\n    await connection.end();\r\n    \r\n    let config = (rows as any[])[0];\r\n    \r\n    // 确保所有字符串字段不为null，转换为空字符串\r\n    if (config) {\r\n      config = {\r\n        ...config,\r\n        site_title: config.site_title || '',\r\n        site_description: config.site_description || '',\r\n        email: config.email || '',\r\n        phone: config.phone || '',\r\n        address: config.address || '',\r\n        social_facebook: config.social_facebook || '',\r\n        social_twitter: config.social_twitter || '',\r\n        social_instagram: config.social_instagram || '',\r\n        social_github: config.social_github || '',\r\n        social_linkedin: config.social_linkedin || '',\r\n        copyright_text: config.copyright_text || ''\r\n      };\r\n    }\r\n    \r\n    return NextResponse.json(config, { status: 200 });\r\n  } catch (error) {\r\n    console.error('获取页尾配置失败:', error);\r\n    return NextResponse.json({ error: '获取页尾配置失败' }, { status: 500 });\r\n  }\r\n}\r\n\r\n// 更新页尾配置\r\nexport async function PUT(request: Request) {\r\n  try {\r\n    const body: FooterConfig = await request.json();\r\n    const connection = await createConnection();\r\n    \r\n    // 检查是否存在配置\r\n    const [existingConfigs] = await connection.execute(\r\n      'SELECT id FROM footer_config ORDER BY id DESC LIMIT 1'\r\n    );\r\n    \r\n    if ((existingConfigs as any[]).length > 0) {\r\n      // 更新现有配置\r\n      const configId = (existingConfigs as any[])[0].id;\r\n      await connection.execute(\r\n        `UPDATE footer_config SET \r\n          site_title = ?, site_description = ?, email = ?, phone = ?, address = ?, \r\n          social_facebook = ?, social_twitter = ?, social_instagram = ?, social_github = ?, social_linkedin = ?, \r\n          quick_links = ?, \r\n          background_color = ?, text_color = ?, link_color = ?, link_hover_color = ?, border_color = ?, font_size = ?, \r\n          layout_columns = ?, show_social_media = ?, show_contact_info = ?, show_quick_links = ?, show_copyright = ?, \r\n          copyright_text = ? \r\n        WHERE id = ?`,\r\n        [\r\n          body.site_title,\r\n          body.site_description,\r\n          body.email,\r\n          body.phone,\r\n          body.address,\r\n          body.social_facebook,\r\n          body.social_twitter,\r\n          body.social_instagram,\r\n          body.social_github,\r\n          body.social_linkedin,\r\n          JSON.stringify(body.quick_links),\r\n          body.background_color,\r\n          body.text_color,\r\n          body.link_color,\r\n          body.link_hover_color,\r\n          body.border_color,\r\n          body.font_size,\r\n          body.layout_columns,\r\n          body.show_social_media,\r\n          body.show_contact_info,\r\n          body.show_quick_links,\r\n          body.show_copyright,\r\n          body.copyright_text,\r\n          configId\r\n        ]\r\n      );\r\n      \r\n      // 获取更新后的配置\r\n      const [updatedConfigs] = await connection.execute(\r\n        'SELECT * FROM footer_config WHERE id = ?',\r\n        [configId]\r\n      );\r\n      await connection.end();\r\n      \r\n      return NextResponse.json((updatedConfigs as any[])[0], { status: 200 });\r\n    } else {\r\n      // 创建新配置\r\n      const [result] = await connection.execute(\r\n        `INSERT INTO footer_config (\r\n          site_title, site_description, email, phone, address, \r\n          social_facebook, social_twitter, social_instagram, social_github, social_linkedin, \r\n          quick_links, \r\n          background_color, text_color, link_color, link_hover_color, border_color, font_size, \r\n          layout_columns, show_social_media, show_contact_info, show_quick_links, show_copyright, \r\n          copyright_text\r\n        ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)`,\r\n        [\r\n          body.site_title,\r\n          body.site_description,\r\n          body.email,\r\n          body.phone,\r\n          body.address,\r\n          body.social_facebook,\r\n          body.social_twitter,\r\n          body.social_instagram,\r\n          body.social_github,\r\n          body.social_linkedin,\r\n          JSON.stringify(body.quick_links),\r\n          body.background_color,\r\n          body.text_color,\r\n          body.link_color,\r\n          body.link_hover_color,\r\n          body.border_color,\r\n          body.font_size,\r\n          body.layout_columns,\r\n          body.show_social_media,\r\n          body.show_contact_info,\r\n          body.show_quick_links,\r\n          body.show_copyright,\r\n          body.copyright_text\r\n        ]\r\n      );\r\n      \r\n      // 获取新创建的配置\r\n      const [newConfigs] = await connection.execute(\r\n        'SELECT * FROM footer_config WHERE id = ?',\r\n        [(result as any).insertId]\r\n      );\r\n      await connection.end();\r\n      \r\n      return NextResponse.json((newConfigs as any[])[0], { status: 201 });\r\n    }\r\n  } catch (error) {\r\n    console.error('更新页尾配置失败:', error);\r\n    return NextResponse.json({ error: '更新页尾配置失败', details: (error as Error).message }, { status: 500 });\r\n  }\r\n}\r\n"],"names":[],"mappings":"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"}}]
}