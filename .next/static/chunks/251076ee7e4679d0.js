(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,33662,e=>{"use strict";var t=e.i(43476),r=e.i(71645),s=e.i(18566),a=e.i(89001);let l=({setMessage:e})=>{let[s,a]=(0,r.useState)(""),[l,n]=(0,r.useState)(""),[o,d]=(0,r.useState)(""),[i,c]=(0,r.useState)(!1),[u,m]=(0,r.useState)(!1),x=e=>e.length<16?"密钥长度至少为16个字符":/[A-Z]/.test(e)?/[a-z]/.test(e)?/[0-9]/.test(e)?/[^A-Za-z0-9]/.test(e)?"":"密钥必须包含至少一个特殊字符":"密钥必须包含至少一个数字":"密钥必须包含至少一个小写字母":"密钥必须包含至少一个大写字母",b=async t=>{if(t.preventDefault(),!u)return void m(!0);let r=x(l);if(r)return void e({type:"error",text:r});if(l!==o)return void e({type:"error",text:"新密钥与确认密钥不匹配"});c(!0);try{let t=await fetch("/api/admin/credentials/secret-key",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({currentKey:s,newKey:l})}),r=await t.json();t.ok?(e({type:"success",text:"管理员密钥更新成功"}),a(""),n(""),d("")):e({type:"error",text:r.error||"更新失败，请重试"})}catch(t){e({type:"error",text:"服务器错误，请稍后重试"})}finally{c(!1),m(!1)}};return(0,t.jsxs)("form",{onSubmit:b,children:[(0,t.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"修改管理员密钥"}),u&&(0,t.jsxs)("div",{className:"bg-yellow-100 border border-yellow-400 text-yellow-700 px-4 py-3 rounded mb-4",children:[(0,t.jsx)("p",{className:"font-bold",children:"确认操作"}),(0,t.jsx)("p",{children:"您确定要修改管理员密钥吗？此操作将影响所有管理员的访问权限。"}),(0,t.jsxs)("div",{className:"mt-2 flex space-x-2",children:[(0,t.jsx)("button",{type:"button",className:"px-4 py-2 bg-gray-200 text-gray-800 rounded hover:bg-gray-300",onClick:()=>m(!1),children:"取消"}),(0,t.jsx)("button",{type:"submit",className:"px-4 py-2 bg-red-500 text-white rounded hover:bg-red-600",children:"确认修改"})]})]}),!u&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"mb-4",children:[(0,t.jsx)("label",{htmlFor:"currentKey",className:"block text-sm font-medium text-gray-700 mb-1",children:"当前管理员密钥"}),(0,t.jsx)("input",{type:"password",id:"currentKey",value:s,onChange:e=>a(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),(0,t.jsxs)("div",{className:"mb-4",children:[(0,t.jsx)("label",{htmlFor:"newKey",className:"block text-sm font-medium text-gray-700 mb-1",children:"新管理员密钥"}),(0,t.jsx)("input",{type:"password",id:"newKey",value:l,onChange:e=>n(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0}),l&&(0,t.jsx)("p",{className:"mt-1 text-xs text-gray-500",children:x(l)||"密钥强度：强"})]}),(0,t.jsxs)("div",{className:"mb-6",children:[(0,t.jsx)("label",{htmlFor:"confirmKey",className:"block text-sm font-medium text-gray-700 mb-1",children:"确认新管理员密钥"}),(0,t.jsx)("input",{type:"password",id:"confirmKey",value:o,onChange:e=>d(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),(0,t.jsx)("div",{className:"flex justify-end",children:(0,t.jsx)("button",{type:"submit",className:"px-6 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2",disabled:i,children:i?"提交中...":"修改密钥"})})]})]})},n=({setMessage:e})=>{let[s,a]=(0,r.useState)(""),[l,n]=(0,r.useState)(""),[o,d]=(0,r.useState)(""),[i,c]=(0,r.useState)(!1),[u,m]=(0,r.useState)(!1),x=e=>e.length<8?"密码长度至少为8个字符":/[A-Z]/.test(e)?/[a-z]/.test(e)?/[0-9]/.test(e)?"":"密码必须包含至少一个数字":"密码必须包含至少一个小写字母":"密码必须包含至少一个大写字母",b=async t=>{if(t.preventDefault(),!u)return void m(!0);let r=x(l);if(r)return void e({type:"error",text:r});if(l!==o)return void e({type:"error",text:"新密码与确认密码不匹配"});c(!0);try{let t=await fetch("/api/admin/credentials/access-password",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({currentPassword:s,newPassword:l})}),r=await t.json();t.ok?(e({type:"success",text:"初始访问密码更新成功"}),a(""),n(""),d("")):e({type:"error",text:r.error||"更新失败，请重试"})}catch(t){e({type:"error",text:"服务器错误，请稍后重试"})}finally{c(!1),m(!1)}};return(0,t.jsxs)("form",{onSubmit:b,children:[(0,t.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"修改初始访问密码"}),u&&(0,t.jsxs)("div",{className:"bg-yellow-100 border border-yellow-400 text-yellow-700 px-4 py-3 rounded mb-4",children:[(0,t.jsx)("p",{className:"font-bold",children:"确认操作"}),(0,t.jsx)("p",{children:"您确定要修改初始访问密码吗？此操作将影响管理员登录入口的访问权限。"}),(0,t.jsxs)("div",{className:"mt-2 flex space-x-2",children:[(0,t.jsx)("button",{type:"button",className:"px-4 py-2 bg-gray-200 text-gray-800 rounded hover:bg-gray-300",onClick:()=>m(!1),children:"取消"}),(0,t.jsx)("button",{type:"submit",className:"px-4 py-2 bg-red-500 text-white rounded hover:bg-red-600",children:"确认修改"})]})]}),!u&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"mb-4",children:[(0,t.jsx)("label",{htmlFor:"currentPassword",className:"block text-sm font-medium text-gray-700 mb-1",children:"当前初始访问密码"}),(0,t.jsx)("input",{type:"password",id:"currentPassword",value:s,onChange:e=>a(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),(0,t.jsxs)("div",{className:"mb-4",children:[(0,t.jsx)("label",{htmlFor:"newPassword",className:"block text-sm font-medium text-gray-700 mb-1",children:"新初始访问密码"}),(0,t.jsx)("input",{type:"password",id:"newPassword",value:l,onChange:e=>n(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0}),l&&(0,t.jsx)("p",{className:"mt-1 text-xs text-gray-500",children:x(l)||"密码强度：强"})]}),(0,t.jsxs)("div",{className:"mb-6",children:[(0,t.jsx)("label",{htmlFor:"confirmPassword",className:"block text-sm font-medium text-gray-700 mb-1",children:"确认新初始访问密码"}),(0,t.jsx)("input",{type:"password",id:"confirmPassword",value:o,onChange:e=>d(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),(0,t.jsx)("div",{className:"flex justify-end",children:(0,t.jsx)("button",{type:"submit",className:"px-6 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2",disabled:i,children:i?"提交中...":"修改密码"})})]})]})};e.s(["default",0,()=>{let e=(0,s.useRouter)();(0,r.useEffect)(()=>{let t=()=>{let t=a.adminAuth.isAuthenticated(),r=a.adminAuth.getCurrentUser();if(!t||!r||"admin"!==r.role)return void e.push("/admin/secret-login")};return t(),(0,a.listenToAdminStateChanges)(t)},[e]);let[o,d]=(0,r.useState)("secret-key"),[i,c]=(0,r.useState)(null),u=e=>{d(e),c(null)};return(0,t.jsxs)("div",{className:"container mx-auto px-4 py-8",children:[(0,t.jsx)("h1",{className:"text-2xl font-bold mb-6",children:"凭证管理"}),i&&(0,t.jsx)("div",{className:`mb-4 p-3 rounded ${"success"===i.type?"bg-green-100 text-green-700":"bg-red-100 text-red-700"}`,children:i.text}),(0,t.jsx)("div",{className:"border-b border-gray-200 mb-6",children:(0,t.jsxs)("nav",{className:"flex space-x-8",children:[(0,t.jsx)("button",{className:`py-3 px-1 border-b-2 font-medium text-sm ${"secret-key"===o?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,onClick:()=>u("secret-key"),children:"修改管理员密钥"}),(0,t.jsx)("button",{className:`py-3 px-1 border-b-2 font-medium text-sm ${"access-password"===o?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,onClick:()=>u("access-password"),children:"修改初始访问密码"})]})}),(0,t.jsxs)("div",{className:"bg-white shadow-md rounded-lg p-6",children:["secret-key"===o&&(0,t.jsx)(l,{setMessage:c}),"access-password"===o&&(0,t.jsx)(n,{setMessage:c})]})]})}])}]);