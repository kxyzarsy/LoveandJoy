{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///D:/MyBlog/LoveandJoy/src/app/admin/secret-login/page.tsx"],"sourcesContent":["'use client'\r\n\r\nimport { useState, useEffect } from 'react'\r\nimport { useRouter } from 'next/navigation'\r\nimport { validateSecret, logLoginAttempt } from '../../../admin-secret'\r\n\r\n/**\r\n * 隐藏式管理员登录页面\r\n * 只有知道正确URL的用户才能访问\r\n */\r\nexport default function SecretAdminLoginPage() {\r\n  const router = useRouter()\r\n  const [username, setUsername] = useState('')\r\n  const [password, setPassword] = useState('')\r\n  const [secretKey, setSecretKey] = useState('')\r\n  const [errors, setErrors] = useState<{ message?: string }>({})\r\n  const [isLoading, setIsLoading] = useState(false)\r\n  const [showSecretField, setShowSecretField] = useState(false)\r\n\r\n  // 隐藏式入口验证：只有输入正确的初始密码才能显示秘钥字段\r\n  const handleInitialSubmit = (e: React.FormEvent<HTMLFormElement>) => {\r\n    e.preventDefault()\r\n    const initialPassword = (e.currentTarget as any).initialPassword.value\r\n    \r\n    // 初始密码验证（简单的隐藏入口机制）\r\n    if (initialPassword === 'admin-portal') {\r\n      setShowSecretField(true)\r\n    } else {\r\n      // 记录失败尝试\r\n      logLoginAttempt({\r\n        username: 'unknown',\r\n        ipAddress: typeof window !== 'undefined' ? window.location.hostname : 'unknown',\r\n        userAgent: typeof window !== 'undefined' ? navigator.userAgent : 'unknown',\r\n        isSuccess: false,\r\n        errorMessage: '初始密码错误'\r\n      })\r\n      setErrors({ message: '访问被拒绝' })\r\n    }\r\n  }\r\n\r\n  const handleLogin = async (e: React.FormEvent<HTMLFormElement>) => {\r\n    e.preventDefault()\r\n    setIsLoading(true)\r\n    setErrors({})\r\n\r\n    try {\r\n      // 记录登录尝试\r\n      await logLoginAttempt({\r\n        username,\r\n        ipAddress: typeof window !== 'undefined' ? window.location.hostname : 'unknown',\r\n        userAgent: typeof window !== 'undefined' ? navigator.userAgent : 'unknown',\r\n        isSuccess: false\r\n      })\r\n\r\n      // 简单的管理员验证逻辑\r\n      const isAdmin = username === 'admin' && password === 'admin123'\r\n      \r\n      if (!isAdmin) {\r\n        await logLoginAttempt({\r\n          username,\r\n          ipAddress: typeof window !== 'undefined' ? window.location.hostname : 'unknown',\r\n          userAgent: typeof window !== 'undefined' ? navigator.userAgent : 'unknown',\r\n          isSuccess: false,\r\n          errorMessage: '用户名或密码错误'\r\n        })\r\n        setErrors({ message: '用户名或密码错误' })\r\n        return\r\n      }\r\n\r\n      // 验证管理员秘钥\r\n      const isSecretValid = await validateSecret(secretKey)\r\n      if (!isSecretValid) {\r\n        await logLoginAttempt({\r\n          username,\r\n          ipAddress: typeof window !== 'undefined' ? window.location.hostname : 'unknown',\r\n          userAgent: typeof window !== 'undefined' ? navigator.userAgent : 'unknown',\r\n          isSuccess: false,\r\n          errorMessage: '管理员秘钥错误'\r\n        })\r\n        setErrors({ message: '管理员秘钥错误' })\r\n        return\r\n      }\r\n\r\n      // 登录成功，记录登录日志\r\n      await logLoginAttempt({\r\n        username,\r\n        ipAddress: typeof window !== 'undefined' ? window.location.hostname : 'unknown',\r\n        userAgent: typeof window !== 'undefined' ? navigator.userAgent : 'unknown',\r\n        isSuccess: true\r\n      })\r\n\r\n      // 保存登录状态到sessionStorage\r\n      sessionStorage.setItem('isLoggedIn', 'true')\r\n      \r\n      // 设置管理员用户数据\r\n      const userData = {\r\n        id: 1,\r\n        name: '管理员',\r\n        email: 'admin@admin',\r\n        avatar: 'https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=100&h=100&fit=crop'\r\n      }\r\n      \r\n      sessionStorage.setItem('user', JSON.stringify(userData))\r\n\r\n      // 跳转到管理员后台首页\r\n      router.push('/admin')\r\n    } catch (error) {\r\n      console.error('登录失败:', error)\r\n      setErrors({ message: '登录失败，请重试' })\r\n      \r\n      // 记录失败日志\r\n      await logLoginAttempt({\r\n        username,\r\n        ipAddress: typeof window !== 'undefined' ? window.location.hostname : 'unknown',\r\n        userAgent: typeof window !== 'undefined' ? navigator.userAgent : 'unknown',\r\n        isSuccess: false,\r\n        errorMessage: '系统错误'\r\n      })\r\n    } finally {\r\n      setIsLoading(false)\r\n    }\r\n  }\r\n\r\n  return (\r\n    <div className=\"min-h-[calc(100vh-200px)] flex items-center justify-center py-12 px-4 sm:px-6 lg:px-8\">\r\n      <div className=\"max-w-md w-full space-y-8\">\r\n        <div>\r\n          <h2 className=\"mt-6 text-center text-3xl font-extrabold text-gray-900\">\r\n            {showSecretField ? '管理员登录' : '访问验证'}\r\n          </h2>\r\n          <p className=\"mt-2 text-center text-sm text-gray-600\">\r\n            {showSecretField ? '请输入管理员账号、密码和秘钥' : '请输入访问密码'}\r\n          </p>\r\n        </div>\r\n\r\n        {errors.message && (\r\n          <div className=\"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-md\">\r\n            {errors.message}\r\n          </div>\r\n        )}\r\n\r\n        {!showSecretField ? (\r\n          // 初始访问验证表单\r\n          <form className=\"mt-8 space-y-6\" onSubmit={handleInitialSubmit}>\r\n            <div>\r\n              <label htmlFor=\"initialPassword\" className=\"sr-only\">\r\n                访问密码\r\n              </label>\r\n              <input\r\n                id=\"initialPassword\"\r\n                name=\"initialPassword\"\r\n                type=\"password\"\r\n                required\r\n                className=\"appearance-none relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-md focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm\"\r\n                placeholder=\"请输入访问密码\"\r\n              />\r\n            </div>\r\n\r\n            <div>\r\n              <button\r\n                type=\"submit\"\r\n                className=\"group relative w-full flex justify-center py-2 px-4 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors\"\r\n              >\r\n                验证访问\r\n              </button>\r\n            </div>\r\n          </form>\r\n        ) : (\r\n          // 完整管理员登录表单\r\n          <form className=\"mt-8 space-y-6\" onSubmit={handleLogin}>\r\n            <div className=\"rounded-md -space-y-px\">\r\n              <div>\r\n                <label htmlFor=\"username\" className=\"sr-only\">\r\n                  用户名\r\n                </label>\r\n                <input\r\n                  id=\"username\"\r\n                  name=\"username\"\r\n                  type=\"text\"\r\n                  autoComplete=\"username\"\r\n                  required\r\n                  className=\"appearance-none rounded-none relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-t-md focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm\"\r\n                  placeholder=\"用户名\"\r\n                  value={username}\r\n                  onChange={(e) => setUsername(e.target.value)}\r\n                />\r\n              </div>\r\n              <div>\r\n                <label htmlFor=\"password\" className=\"sr-only\">\r\n                  密码\r\n                </label>\r\n                <input\r\n                  id=\"password\"\r\n                  name=\"password\"\r\n                  type=\"password\"\r\n                  autoComplete=\"current-password\"\r\n                  required\r\n                  className=\"appearance-none rounded-none relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm\"\r\n                  placeholder=\"密码\"\r\n                  value={password}\r\n                  onChange={(e) => setPassword(e.target.value)}\r\n                />\r\n              </div>\r\n              <div>\r\n                <label htmlFor=\"secretKey\" className=\"sr-only\">\r\n                  管理员秘钥\r\n                </label>\r\n                <input\r\n                  id=\"secretKey\"\r\n                  name=\"secretKey\"\r\n                  type=\"password\"\r\n                  required\r\n                  className=\"appearance-none rounded-b-md relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm\"\r\n                  placeholder=\"管理员秘钥\"\r\n                  value={secretKey}\r\n                  onChange={(e) => setSecretKey(e.target.value)}\r\n                />\r\n              </div>\r\n            </div>\r\n\r\n            <div>\r\n              <button\r\n                type=\"submit\"\r\n                disabled={isLoading}\r\n                className=\"group relative w-full flex justify-center py-2 px-4 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors disabled:opacity-70 disabled:cursor-not-allowed\"\r\n              >\r\n                {isLoading ? '登录中...' : '登录'}\r\n              </button>\r\n            </div>\r\n          </form>\r\n        )}\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n"],"names":[],"mappings":";;;;;AAEA;AACA;;;;;;;;AAHA;;;;AAUe,SAAS;;IACtB,MAAM,SAAS,IAAA,kJAAS;IACxB,MAAM,CAAC,UAAU,YAAY,GAAG,IAAA,yKAAQ,EAAC;IACzC,MAAM,CAAC,UAAU,YAAY,GAAG,IAAA,yKAAQ,EAAC;IACzC,MAAM,CAAC,WAAW,aAAa,GAAG,IAAA,yKAAQ,EAAC;IAC3C,MAAM,CAAC,QAAQ,UAAU,GAAG,IAAA,yKAAQ,EAAuB,CAAC;IAC5D,MAAM,CAAC,WAAW,aAAa,GAAG,IAAA,yKAAQ,EAAC;IAC3C,MAAM,CAAC,iBAAiB,mBAAmB,GAAG,IAAA,yKAAQ,EAAC;IAEvD,8BAA8B;IAC9B,MAAM,sBAAsB,CAAC;QAC3B,EAAE,cAAc;QAChB,MAAM,kBAAkB,AAAC,EAAE,aAAa,CAAS,eAAe,CAAC,KAAK;QAEtE,oBAAoB;QACpB,IAAI,oBAAoB,gBAAgB;YACtC,mBAAmB;QACrB,OAAO;YACL,SAAS;YACT,gBAAgB;gBACd,UAAU;gBACV,WAAW,uCAAgC,OAAO,QAAQ,CAAC,QAAQ,GAAG;gBACtE,WAAW,uCAAgC,UAAU,SAAS,GAAG;gBACjE,WAAW;gBACX,cAAc;YAChB;YACA,UAAU;gBAAE,SAAS;YAAQ;QAC/B;IACF;IAEA,MAAM,cAAc,OAAO;QACzB,EAAE,cAAc;QAChB,aAAa;QACb,UAAU,CAAC;QAEX,IAAI;YACF,SAAS;YACT,MAAM,gBAAgB;gBACpB;gBACA,WAAW,uCAAgC,OAAO,QAAQ,CAAC,QAAQ,GAAG;gBACtE,WAAW,uCAAgC,UAAU,SAAS,GAAG;gBACjE,WAAW;YACb;YAEA,aAAa;YACb,MAAM,UAAU,aAAa,WAAW,aAAa;YAErD,IAAI,CAAC,SAAS;gBACZ,MAAM,gBAAgB;oBACpB;oBACA,WAAW,uCAAgC,OAAO,QAAQ,CAAC,QAAQ,GAAG;oBACtE,WAAW,uCAAgC,UAAU,SAAS,GAAG;oBACjE,WAAW;oBACX,cAAc;gBAChB;gBACA,UAAU;oBAAE,SAAS;gBAAW;gBAChC;YACF;YAEA,UAAU;YACV,MAAM,gBAAgB,MAAM,eAAe;YAC3C,IAAI,CAAC,eAAe;gBAClB,MAAM,gBAAgB;oBACpB;oBACA,WAAW,uCAAgC,OAAO,QAAQ,CAAC,QAAQ,GAAG;oBACtE,WAAW,uCAAgC,UAAU,SAAS,GAAG;oBACjE,WAAW;oBACX,cAAc;gBAChB;gBACA,UAAU;oBAAE,SAAS;gBAAU;gBAC/B;YACF;YAEA,cAAc;YACd,MAAM,gBAAgB;gBACpB;gBACA,WAAW,uCAAgC,OAAO,QAAQ,CAAC,QAAQ,GAAG;gBACtE,WAAW,uCAAgC,UAAU,SAAS,GAAG;gBACjE,WAAW;YACb;YAEA,wBAAwB;YACxB,eAAe,OAAO,CAAC,cAAc;YAErC,YAAY;YACZ,MAAM,WAAW;gBACf,IAAI;gBACJ,MAAM;gBACN,OAAO;gBACP,QAAQ;YACV;YAEA,eAAe,OAAO,CAAC,QAAQ,KAAK,SAAS,CAAC;YAE9C,aAAa;YACb,OAAO,IAAI,CAAC;QACd,EAAE,OAAO,OAAO;YACd,QAAQ,KAAK,CAAC,SAAS;YACvB,UAAU;gBAAE,SAAS;YAAW;YAEhC,SAAS;YACT,MAAM,gBAAgB;gBACpB;gBACA,WAAW,uCAAgC,OAAO,QAAQ,CAAC,QAAQ,GAAG;gBACtE,WAAW,uCAAgC,UAAU,SAAS,GAAG;gBACjE,WAAW;gBACX,cAAc;YAChB;QACF,SAAU;YACR,aAAa;QACf;IACF;IAEA,qBACE,6LAAC;QAAI,WAAU;kBACb,cAAA,6LAAC;YAAI,WAAU;;8BACb,6LAAC;;sCACC,6LAAC;4BAAG,WAAU;sCACX,kBAAkB,UAAU;;;;;;sCAE/B,6LAAC;4BAAE,WAAU;sCACV,kBAAkB,mBAAmB;;;;;;;;;;;;gBAIzC,OAAO,OAAO,kBACb,6LAAC;oBAAI,WAAU;8BACZ,OAAO,OAAO;;;;;;gBAIlB,CAAC,kBACA,WAAW;8BACX,6LAAC;oBAAK,WAAU;oBAAiB,UAAU;;sCACzC,6LAAC;;8CACC,6LAAC;oCAAM,SAAQ;oCAAkB,WAAU;8CAAU;;;;;;8CAGrD,6LAAC;oCACC,IAAG;oCACH,MAAK;oCACL,MAAK;oCACL,QAAQ;oCACR,WAAU;oCACV,aAAY;;;;;;;;;;;;sCAIhB,6LAAC;sCACC,cAAA,6LAAC;gCACC,MAAK;gCACL,WAAU;0CACX;;;;;;;;;;;;;;;;2BAML,YAAY;8BACZ,6LAAC;oBAAK,WAAU;oBAAiB,UAAU;;sCACzC,6LAAC;4BAAI,WAAU;;8CACb,6LAAC;;sDACC,6LAAC;4CAAM,SAAQ;4CAAW,WAAU;sDAAU;;;;;;sDAG9C,6LAAC;4CACC,IAAG;4CACH,MAAK;4CACL,MAAK;4CACL,cAAa;4CACb,QAAQ;4CACR,WAAU;4CACV,aAAY;4CACZ,OAAO;4CACP,UAAU,CAAC,IAAM,YAAY,EAAE,MAAM,CAAC,KAAK;;;;;;;;;;;;8CAG/C,6LAAC;;sDACC,6LAAC;4CAAM,SAAQ;4CAAW,WAAU;sDAAU;;;;;;sDAG9C,6LAAC;4CACC,IAAG;4CACH,MAAK;4CACL,MAAK;4CACL,cAAa;4CACb,QAAQ;4CACR,WAAU;4CACV,aAAY;4CACZ,OAAO;4CACP,UAAU,CAAC,IAAM,YAAY,EAAE,MAAM,CAAC,KAAK;;;;;;;;;;;;8CAG/C,6LAAC;;sDACC,6LAAC;4CAAM,SAAQ;4CAAY,WAAU;sDAAU;;;;;;sDAG/C,6LAAC;4CACC,IAAG;4CACH,MAAK;4CACL,MAAK;4CACL,QAAQ;4CACR,WAAU;4CACV,aAAY;4CACZ,OAAO;4CACP,UAAU,CAAC,IAAM,aAAa,EAAE,MAAM,CAAC,KAAK;;;;;;;;;;;;;;;;;;sCAKlD,6LAAC;sCACC,cAAA,6LAAC;gCACC,MAAK;gCACL,UAAU;gCACV,WAAU;0CAET,YAAY,WAAW;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAQxC;GAhOwB;;QACP,kJAAS;;;KADF"}}]
}