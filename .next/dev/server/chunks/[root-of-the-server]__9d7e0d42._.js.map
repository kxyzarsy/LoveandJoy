{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 124, "column": 0}, "map": {"version":3,"sources":["file:///D:/MyBlog/LoveandJoy/src/lib/db-pool.ts"],"sourcesContent":["import mysql from 'mysql2/promise';\n\n// 数据库连接配置\nconst DB_CONFIG = {\n  host: 'localhost',\n  port: 3306,\n  user: 'root',\n  password: '123456',\n  database: 'yueblog',\n  // 连接池配置\n  connectionLimit: 10, // 最大连接数\n  queueLimit: 0, // 连接请求队列大小，0表示无限制\n  waitForConnections: true, // 当连接池无可用连接时，是否等待\n  connectTimeout: 10000, // 建立连接的超时时间（毫秒）\n  idleTimeout: 60000, // 连接空闲超时时间（毫秒）\n  enableKeepAlive: true, // 启用TCP KeepAlive\n  keepAliveInitialDelay: 30000 // TCP KeepAlive初始延迟（毫秒）\n};\n\n// 创建数据库连接池\nconst pool = mysql.createPool(DB_CONFIG);\n\n/**\n * 获取数据库连接\n * @returns Promise<mysql.PoolConnection> 数据库连接对象\n */\nexport const getConnection = async (): Promise<mysql.PoolConnection> => {\n  try {\n    const connection = await pool.getConnection();\n    return connection;\n  } catch (error) {\n    console.error('获取数据库连接失败:', error);\n    throw error;\n  }\n};\n\n/**\n * 释放数据库连接\n * @param connection 数据库连接对象\n */\nexport const releaseConnection = (connection: mysql.PoolConnection): void => {\n  try {\n    connection.release();\n  } catch (error) {\n    console.error('释放数据库连接失败:', error);\n  }\n};\n\n/**\n * 执行SQL查询（自动管理连接）\n * @param sql SQL查询语句\n * @param values 查询参数\n * @returns Promise<[mysql.QueryResult, mysql.FieldPacket[]]> 查询结果\n */\nexport const executeQuery = async (sql: string, values?: any[]): Promise<[mysql.QueryResult, mysql.FieldPacket[]]> => {\n  let connection: mysql.PoolConnection | null = null;\n  try {\n    connection = await getConnection();\n    const result = await connection.execute(sql, values);\n    return result;\n  } catch (error) {\n    console.error('执行SQL查询失败:', error);\n    throw error;\n  } finally {\n    if (connection) {\n      releaseConnection(connection);\n    }\n  }\n};\n\n/**\n * 执行事务操作\n * @param callback 事务回调函数，接收connection参数，返回Promise\n * @returns Promise<T> 事务执行结果\n */\nexport const executeTransaction = async <T>(callback: (connection: mysql.PoolConnection) => Promise<T>): Promise<T> => {\n  let connection: mysql.PoolConnection | null = null;\n  try {\n    connection = await getConnection();\n    await connection.beginTransaction();\n    const result = await callback(connection);\n    await connection.commit();\n    return result;\n  } catch (error) {\n    if (connection) {\n      await connection.rollback();\n    }\n    console.error('执行事务失败:', error);\n    throw error;\n  } finally {\n    if (connection) {\n      releaseConnection(connection);\n    }\n  }\n};\n\n/**\n * 获取连接池状态\n * @returns Promise<{ size: number, used: number, free: number, pending: number }> 连接池状态\n */\nexport const getPoolStatus = async (): Promise<{ size: number; used: number; free: number; pending: number }> => {\n  try {\n    // 由于mysql2连接池的私有属性无法直接访问，我们返回配置的连接参数\n    return {\n      size: DB_CONFIG.connectionLimit,\n      used: 0, // 无法直接获取，返回0\n      free: DB_CONFIG.connectionLimit, // 无法直接获取，返回配置的连接数\n      pending: 0 // 无法直接获取，返回0\n    };\n  } catch (error) {\n    console.error('获取连接池状态失败:', error);\n    return {\n      size: 0,\n      used: 0,\n      free: 0,\n      pending: 0\n    };\n  }\n};\n\n/**\n * 关闭连接池\n */\nexport const closePool = async (): Promise<void> => {\n  try {\n    await pool.end();\n    console.log('数据库连接池已关闭');\n  } catch (error) {\n    console.error('关闭连接池失败:', error);\n    throw error;\n  }\n};\n\n// 导出连接池，方便直接使用\nexport default pool;\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;AAAA;;AAEA,UAAU;AACV,MAAM,YAAY;IAChB,MAAM;IACN,MAAM;IACN,MAAM;IACN,UAAU;IACV,UAAU;IACV,QAAQ;IACR,iBAAiB;IACjB,YAAY;IACZ,oBAAoB;IACpB,gBAAgB;IAChB,aAAa;IACb,iBAAiB;IACjB,uBAAuB,MAAM,wBAAwB;AACvD;AAEA,WAAW;AACX,MAAM,OAAO,8IAAK,CAAC,UAAU,CAAC;AAMvB,MAAM,gBAAgB;IAC3B,IAAI;QACF,MAAM,aAAa,MAAM,KAAK,aAAa;QAC3C,OAAO;IACT,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,cAAc;QAC5B,MAAM;IACR;AACF;AAMO,MAAM,oBAAoB,CAAC;IAChC,IAAI;QACF,WAAW,OAAO;IACpB,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,cAAc;IAC9B;AACF;AAQO,MAAM,eAAe,OAAO,KAAa;IAC9C,IAAI,aAA0C;IAC9C,IAAI;QACF,aAAa,MAAM;QACnB,MAAM,SAAS,MAAM,WAAW,OAAO,CAAC,KAAK;QAC7C,OAAO;IACT,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,cAAc;QAC5B,MAAM;IACR,SAAU;QACR,IAAI,YAAY;YACd,kBAAkB;QACpB;IACF;AACF;AAOO,MAAM,qBAAqB,OAAU;IAC1C,IAAI,aAA0C;IAC9C,IAAI;QACF,aAAa,MAAM;QACnB,MAAM,WAAW,gBAAgB;QACjC,MAAM,SAAS,MAAM,SAAS;QAC9B,MAAM,WAAW,MAAM;QACvB,OAAO;IACT,EAAE,OAAO,OAAO;QACd,IAAI,YAAY;YACd,MAAM,WAAW,QAAQ;QAC3B;QACA,QAAQ,KAAK,CAAC,WAAW;QACzB,MAAM;IACR,SAAU;QACR,IAAI,YAAY;YACd,kBAAkB;QACpB;IACF;AACF;AAMO,MAAM,gBAAgB;IAC3B,IAAI;QACF,qCAAqC;QACrC,OAAO;YACL,MAAM,UAAU,eAAe;YAC/B,MAAM;YACN,MAAM,UAAU,eAAe;YAC/B,SAAS,EAAE,aAAa;QAC1B;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,cAAc;QAC5B,OAAO;YACL,MAAM;YACN,MAAM;YACN,MAAM;YACN,SAAS;QACX;IACF;AACF;AAKO,MAAM,YAAY;IACvB,IAAI;QACF,MAAM,KAAK,GAAG;QACd,QAAQ,GAAG,CAAC;IACd,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,YAAY;QAC1B,MAAM;IACR;AACF;uCAGe"}},
    {"offset": {"line": 244, "column": 0}, "map": {"version":3,"sources":["file:///D:/MyBlog/LoveandJoy/src/utils/error-handler.ts"],"sourcesContent":["/**\n * 统一错误处理工具\n * 用于在整个应用中实现一致的错误捕获、处理和返回机制\n */\n\n// 基础错误代码枚举\nexport enum ErrorCode {\n  // 通用错误\n  INTERNAL_SERVER_ERROR = 'INTERNAL_SERVER_ERROR',\n  BAD_REQUEST = 'BAD_REQUEST',\n  NOT_FOUND = 'NOT_FOUND',\n  UNAUTHORIZED = 'UNAUTHORIZED',\n  FORBIDDEN = 'FORBIDDEN',\n  CONFLICT = 'CONFLICT',\n  VALIDATION_ERROR = 'VALIDATION_ERROR',\n  NETWORK_ERROR = 'NETWORK_ERROR',\n  TIMEOUT_ERROR = 'TIMEOUT_ERROR',\n  SERVICE_UNAVAILABLE = 'SERVICE_UNAVAILABLE',\n  RATE_LIMIT_EXCEEDED = 'RATE_LIMIT_EXCEEDED',\n  UNPROCESSABLE_ENTITY = 'UNPROCESSABLE_ENTITY',\n  TOO_MANY_REQUESTS = 'TOO_MANY_REQUESTS',\n  \n  // 认证相关\n  AUTHENTICATION_ERROR = 'AUTHENTICATION_ERROR',\n  AUTHORIZATION_ERROR = 'AUTHORIZATION_ERROR',\n  TOKEN_ERROR = 'TOKEN_ERROR',\n  SESSION_ERROR = 'SESSION_ERROR',\n  \n  // 数据库相关\n  DATABASE_ERROR = 'DATABASE_ERROR',\n  TRANSACTION_ERROR = 'TRANSACTION_ERROR',\n  CONSTRAINT_ERROR = 'CONSTRAINT_ERROR',\n  FOREIGN_KEY_ERROR = 'FOREIGN_KEY_ERROR',\n  UNIQUE_CONSTRAINT_ERROR = 'UNIQUE_CONSTRAINT_ERROR',\n  \n  // 业务相关\n  USER_ERROR = 'USER_ERROR',\n  POST_ERROR = 'POST_ERROR',\n  CATEGORY_ERROR = 'CATEGORY_ERROR',\n  COMMENT_ERROR = 'COMMENT_ERROR',\n  \n  // 安全相关\n  SECURITY_ERROR = 'SECURITY_ERROR',\n  VALIDATION_FAILED = 'VALIDATION_FAILED',\n}\n\n// 统一错误响应接口\nexport interface ErrorResponse {\n  error: {\n    code: ErrorCode;\n    message: string;\n    details?: any;\n    timestamp: string;\n    requestId?: string;\n  };\n  success: false;\n}\n\n// 自定义错误类\nexport class AppError extends Error {\n  constructor(\n    public code: ErrorCode,\n    message: string,\n    public details?: any,\n    public requestId?: string\n  ) {\n    super(message);\n    this.name = 'AppError';\n    Error.captureStackTrace(this, this.constructor);\n  }\n}\n\n// 生成唯一请求ID\nconst generateRequestId = (): string => {\n  return Math.random().toString(36).substring(2, 15) + Math.random().toString(36).substring(2, 15);\n};\n\n// 创建错误响应\nexport const createErrorResponse = (error: AppError | Error, requestId?: string): ErrorResponse => {\n  const timestamp = new Date().toISOString();\n  const reqId = requestId || generateRequestId();\n  \n  if (error instanceof AppError) {\n    return {\n      success: false,\n      error: {\n        code: error.code,\n        message: error.message,\n        details: error.details,\n        timestamp,\n        requestId: error.requestId || reqId,\n      },\n    };\n  }\n  \n  // 处理未知错误\n  return {\n    success: false,\n    error: {\n      code: ErrorCode.INTERNAL_SERVER_ERROR,\n      message: error.message || 'An unexpected error occurred',\n      details: process.env.NODE_ENV === 'development' ? error.stack : undefined,\n      timestamp,\n      requestId: reqId,\n    },\n  };\n};\n\n// 错误处理中间件（用于API路由）\nexport const handleApiError = async (\n  fn: () => Promise<Response>,\n  requestId?: string\n): Promise<Response> => {\n  try {\n    return await fn();\n  } catch (error) {\n    const errorResponse = createErrorResponse(error as Error, requestId);\n    \n    // 根据错误代码设置HTTP状态码\n    const statusCode = getStatusCodeForError(errorResponse.error.code);\n    \n    return new Response(JSON.stringify(errorResponse), {\n      status: statusCode,\n      headers: {\n        'Content-Type': 'application/json',\n        'X-Request-ID': errorResponse.error.requestId!,\n      },\n    });\n  }\n};\n\n// 获取错误对应的HTTP状态码\nconst getStatusCodeForError = (code: ErrorCode): number => {\n  const statusMap: Record<ErrorCode, number> = {\n    [ErrorCode.BAD_REQUEST]: 400,\n    [ErrorCode.NOT_FOUND]: 404,\n    [ErrorCode.UNAUTHORIZED]: 401,\n    [ErrorCode.FORBIDDEN]: 403,\n    [ErrorCode.CONFLICT]: 409,\n    [ErrorCode.VALIDATION_ERROR]: 400,\n    [ErrorCode.VALIDATION_FAILED]: 400,\n    [ErrorCode.NETWORK_ERROR]: 503,\n    [ErrorCode.TIMEOUT_ERROR]: 504,\n    [ErrorCode.SERVICE_UNAVAILABLE]: 503,\n    [ErrorCode.RATE_LIMIT_EXCEEDED]: 429,\n    [ErrorCode.UNPROCESSABLE_ENTITY]: 422,\n    [ErrorCode.TOO_MANY_REQUESTS]: 429,\n    [ErrorCode.AUTHENTICATION_ERROR]: 401,\n    [ErrorCode.AUTHORIZATION_ERROR]: 403,\n    [ErrorCode.TOKEN_ERROR]: 401,\n    [ErrorCode.SESSION_ERROR]: 401,\n    [ErrorCode.DATABASE_ERROR]: 500,\n    [ErrorCode.TRANSACTION_ERROR]: 500,\n    [ErrorCode.CONSTRAINT_ERROR]: 400,\n    [ErrorCode.FOREIGN_KEY_ERROR]: 400,\n    [ErrorCode.UNIQUE_CONSTRAINT_ERROR]: 409,\n    [ErrorCode.USER_ERROR]: 400,\n    [ErrorCode.POST_ERROR]: 400,\n    [ErrorCode.CATEGORY_ERROR]: 400,\n    [ErrorCode.COMMENT_ERROR]: 400,\n    [ErrorCode.SECURITY_ERROR]: 403,\n    [ErrorCode.INTERNAL_SERVER_ERROR]: 500,\n  };\n  \n  return statusMap[code] || 500;\n};\n\n// 验证错误处理\nexport const handleValidationError = (errors: any[]): AppError => {\n  return new AppError(\n    ErrorCode.VALIDATION_ERROR,\n    'Validation failed',\n    { errors }\n  );\n};\n\n// 数据库错误处理\nexport const handleDatabaseError = (error: any): AppError => {\n  let code = ErrorCode.DATABASE_ERROR;\n  let message = 'Database operation failed';\n  \n  // 根据错误信息识别具体错误类型\n  if (error.code) {\n    switch (error.code) {\n      case 'ER_DUP_ENTRY':\n        code = ErrorCode.UNIQUE_CONSTRAINT_ERROR;\n        message = 'Duplicate entry';\n        break;\n      case 'ER_NO_REFERENCED_ROW_2':\n      case 'ER_ROW_IS_REFERENCED_2':\n        code = ErrorCode.FOREIGN_KEY_ERROR;\n        message = 'Foreign key constraint violation';\n        break;\n      case 'ER_BAD_NULL_ERROR':\n        code = ErrorCode.CONSTRAINT_ERROR;\n        message = 'Not null constraint violation';\n        break;\n      default:\n        break;\n    }\n  }\n  \n  return new AppError(code, message, process.env.NODE_ENV === 'development' ? error : undefined);\n};\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 435, "column": 0}, "map": {"version":3,"sources":["file:///D:/MyBlog/LoveandJoy/src/utils/security-logger.ts"],"sourcesContent":["/**\n * 安全日志记录工具\n * 用于记录关键操作和安全事件，支持分级存储和定期备份\n */\n\n// 日志级别枚举\nexport enum LogLevel {\n  DEBUG = 'DEBUG',\n  INFO = 'INFO',\n  WARN = 'WARN',\n  ERROR = 'ERROR',\n  CRITICAL = 'CRITICAL',\n  SECURITY = 'SECURITY', // 安全相关事件\n}\n\n// 日志类型枚举\nexport enum LogType {\n  AUTHENTICATION = 'AUTHENTICATION',\n  AUTHORIZATION = 'AUTHORIZATION',\n  USER_ACTION = 'USER_ACTION',\n  SYSTEM_EVENT = 'SYSTEM_EVENT',\n  SECURITY_VIOLATION = 'SECURITY_VIOLATION',\n  DATA_ACCESS = 'DATA_ACCESS',\n  API_CALL = 'API_CALL',\n  DATABASE_OPERATION = 'DATABASE_OPERATION',\n  VALIDATION_ERROR = 'VALIDATION_ERROR',\n}\n\n// 安全日志接口\nexport interface SecurityLog {\n  id: string;\n  timestamp: string;\n  level: LogLevel;\n  type: LogType;\n  message: string;\n  userId?: string;\n  username?: string;\n  ipAddress: string;\n  userAgent?: string;\n  action: string;\n  resource?: string;\n  status: 'SUCCESS' | 'FAILURE';\n  details?: any;\n  requestId?: string;\n}\n\n// 日志配置接口\ninterface LoggerConfig {\n  logLevel: LogLevel;\n  maxFileSize: number; // 最大文件大小（字节）\n  backupCount: number; // 备份文件数量\n  logDirectory: string;\n  enableConsoleLogging: boolean;\n  enableFileLogging: boolean;\n}\n\n// 默认配置\nconst DEFAULT_CONFIG: LoggerConfig = {\n  logLevel: LogLevel.INFO,\n  maxFileSize: 10 * 1024 * 1024, // 10MB\n  backupCount: 5,\n  logDirectory: 'logs',\n  enableConsoleLogging: true,\n  enableFileLogging: true,\n};\n\n// 生成唯一日志ID\nconst generateLogId = (): string => {\n  return Math.random().toString(36).substring(2, 15) + Math.random().toString(36).substring(2, 15);\n};\n\n// 检查日志级别\nconst shouldLog = (level: LogLevel, configLevel: LogLevel): boolean => {\n  const levels = [LogLevel.DEBUG, LogLevel.INFO, LogLevel.WARN, LogLevel.ERROR, LogLevel.CRITICAL, LogLevel.SECURITY];\n  return levels.indexOf(level) >= levels.indexOf(configLevel);\n};\n\n// 格式化日志消息\nconst formatLogMessage = (log: SecurityLog): string => {\n  const baseLog = `${log.timestamp} [${log.level}] [${log.type}] [${log.action}] [${log.status}]`;\n  const userInfo = log.userId ? ` [User: ${log.userId} (${log.username || 'N/A'})]` : '';\n  const requestInfo = log.requestId ? ` [Request: ${log.requestId}]` : '';\n  const resourceInfo = log.resource ? ` [Resource: ${log.resource}]` : '';\n  const ipInfo = ` [IP: ${log.ipAddress}]`;\n  const details = log.details ? ` Details: ${JSON.stringify(log.details)}` : '';\n  \n  return `${baseLog}${userInfo}${requestInfo}${resourceInfo}${ipInfo} - ${log.message}${details}`;\n};\n\n// 安全日志记录器类\nexport class SecurityLogger {\n  private config: LoggerConfig;\n  private logQueue: SecurityLog[] = [];\n  private flushInterval: NodeJS.Timeout | null = null;\n  \n  constructor(config?: Partial<LoggerConfig>) {\n    this.config = { ...DEFAULT_CONFIG, ...config };\n    \n    // 初始化日志目录\n    this.initLogDirectory();\n    \n    // 设置定期刷新队列\n    this.flushInterval = setInterval(() => {\n      this.flushLogQueue();\n    }, 5000); // 每5秒刷新一次\n  }\n  \n  private initLogDirectory(): void {\n    if (this.config.enableFileLogging) {\n      try {\n        // 只在服务器端使用fs模块\n        if (typeof window === 'undefined') {\n          const fs = require('fs');\n          const path = require('path');\n          \n          const logDir = path.join(process.cwd(), this.config.logDirectory);\n          if (!fs.existsSync(logDir)) {\n            fs.mkdirSync(logDir, { recursive: true });\n          }\n        }\n      } catch (error) {\n        console.error('Failed to initialize log directory:', error);\n      }\n    }\n  }\n  \n  // 记录日志\n  public log(\n    level: LogLevel,\n    type: LogType,\n    message: string,\n    options: {\n      userId?: string;\n      username?: string;\n      ipAddress: string;\n      userAgent?: string;\n      action: string;\n      resource?: string;\n      status: 'SUCCESS' | 'FAILURE';\n      details?: any;\n      requestId?: string;\n    }\n  ): void {\n    if (!shouldLog(level, this.config.logLevel)) {\n      return;\n    }\n    \n    const log: SecurityLog = {\n      id: generateLogId(),\n      timestamp: new Date().toISOString(),\n      level,\n      type,\n      message,\n      ...options,\n    };\n    \n    // 添加到日志队列\n    this.logQueue.push(log);\n    \n    // 立即输出到控制台\n    if (this.config.enableConsoleLogging) {\n      this.logToConsole(log);\n    }\n    \n    // 如果是高优先级日志，立即写入文件\n    if ([LogLevel.ERROR, LogLevel.CRITICAL, LogLevel.SECURITY].includes(level)) {\n      this.flushLogQueue();\n    }\n  }\n  \n  // 记录控制台日志\n  private logToConsole(log: SecurityLog): void {\n    const formattedMessage = formatLogMessage(log);\n    \n    switch (log.level) {\n      case LogLevel.DEBUG:\n        console.debug(formattedMessage);\n        break;\n      case LogLevel.INFO:\n        console.info(formattedMessage);\n        break;\n      case LogLevel.WARN:\n        console.warn(formattedMessage);\n        break;\n      case LogLevel.ERROR:\n      case LogLevel.SECURITY:\n        console.error(formattedMessage);\n        break;\n      case LogLevel.CRITICAL:\n        console.error('\\x1b[31m' + formattedMessage + '\\x1b[0m'); // 红色\n        break;\n      default:\n        console.log(formattedMessage);\n    }\n  }\n  \n  // 记录文件日志\n  private async logToFile(log: SecurityLog): Promise<void> {\n    if (!this.config.enableFileLogging) {\n      return;\n    }\n    \n    try {\n      // 只在服务器端使用fs模块\n      if (typeof window === 'undefined') {\n        const fs = require('fs');\n        const path = require('path');\n        \n        // 按日期和类型分文件\n        const today = new Date().toISOString().split('T')[0];\n        const logFileName = `${today}-${log.type.toLowerCase()}.log`;\n        const logFilePath = path.join(process.cwd(), this.config.logDirectory, logFileName);\n        \n        const formattedMessage = formatLogMessage(log) + '\\n';\n        \n        // 写入文件（追加模式）\n        fs.appendFileSync(logFilePath, formattedMessage, 'utf8');\n        \n        // 检查文件大小，超过则备份\n        this.checkAndRotateLogs(logFilePath);\n      }\n    } catch (error) {\n      console.error('Failed to write log to file:', error);\n    }\n  }\n  \n  // 检查并轮换日志文件\n  private checkAndRotateLogs(filePath: string): void {\n    try {\n      // 只在服务器端使用fs模块\n      if (typeof window === 'undefined') {\n        const fs = require('fs');\n        const path = require('path');\n        \n        const stats = fs.statSync(filePath);\n        if (stats.size > this.config.maxFileSize) {\n          // 备份当前文件\n          const backupPath = `${filePath}.${Date.now()}`;\n          fs.renameSync(filePath, backupPath);\n          \n          // 创建新文件\n          fs.writeFileSync(filePath, '', 'utf8');\n          \n          // 清理旧备份\n          this.cleanupOldBackups(path.dirname(filePath), path.basename(filePath));\n        }\n      }\n    } catch (error) {\n      console.error('Failed to rotate logs:', error);\n    }\n  }\n  \n  // 清理旧备份文件\n  private cleanupOldBackups(directory: string, baseFileName: string): void {\n    try {\n      // 只在服务器端使用fs模块\n      if (typeof window === 'undefined') {\n        const fs = require('fs');\n        const path = require('path');\n        \n        // 获取所有备份文件\n        const files = fs.readdirSync(directory)\n          .filter((file: string) => file.startsWith(baseFileName) && file !== baseFileName)\n          .map((file: string) => path.join(directory, file))\n          .sort((a: string, b: string) => {\n            return fs.statSync(a).mtime.getTime() - fs.statSync(b).mtime.getTime();\n          });\n        \n        // 删除多余的备份\n        while (files.length > this.config.backupCount) {\n          const oldFile = files.shift();\n          if (oldFile) {\n            fs.unlinkSync(oldFile);\n          }\n        }\n      }\n    } catch (error) {\n      console.error('Failed to cleanup old backups:', error);\n    }\n  }\n  \n  // 刷新日志队列\n  private flushLogQueue(): void {\n    if (this.logQueue.length === 0) {\n      return;\n    }\n    \n    // 复制并清空队列\n    const logsToWrite = [...this.logQueue];\n    this.logQueue = [];\n    \n    // 写入所有日志\n    logsToWrite.forEach(log => {\n      this.logToFile(log).catch(error => {\n        console.error('Failed to write log:', error);\n      });\n    });\n  }\n  \n  // 记录认证事件\n  public logAuthentication(\n    message: string,\n    options: {\n      userId?: string;\n      username?: string;\n      ipAddress: string;\n      userAgent?: string;\n      action: string;\n      status: 'SUCCESS' | 'FAILURE';\n      details?: any;\n      requestId?: string;\n    }\n  ): void {\n    this.log(\n      options.status === 'FAILURE' ? LogLevel.SECURITY : LogLevel.INFO,\n      LogType.AUTHENTICATION,\n      message,\n      options\n    );\n  }\n  \n  // 记录授权事件\n  public logAuthorization(\n    message: string,\n    options: {\n      userId?: string;\n      username?: string;\n      ipAddress: string;\n      userAgent?: string;\n      action: string;\n      resource: string;\n      status: 'SUCCESS' | 'FAILURE';\n      details?: any;\n      requestId?: string;\n    }\n  ): void {\n    this.log(\n      options.status === 'FAILURE' ? LogLevel.SECURITY : LogLevel.INFO,\n      LogType.AUTHORIZATION,\n      message,\n      options\n    );\n  }\n  \n  // 记录API调用\n  public logApiCall(\n    message: string,\n    options: {\n      userId?: string;\n      username?: string;\n      ipAddress: string;\n      userAgent?: string;\n      action: string;\n      resource: string;\n      status: 'SUCCESS' | 'FAILURE';\n      details?: any;\n      requestId?: string;\n    }\n  ): void {\n    this.log(\n      options.status === 'FAILURE' ? LogLevel.ERROR : LogLevel.INFO,\n      LogType.API_CALL,\n      message,\n      options\n    );\n  }\n  \n  // 记录安全违规\n  public logSecurityViolation(\n    message: string,\n    options: {\n      userId?: string;\n      username?: string;\n      ipAddress: string;\n      userAgent?: string;\n      action: string;\n      resource?: string;\n      details?: any;\n      requestId?: string;\n    }\n  ): void {\n    this.log(\n      LogLevel.SECURITY,\n      LogType.SECURITY_VIOLATION,\n      message,\n      {\n        ...options,\n        status: 'FAILURE',\n      }\n    );\n  }\n  \n  // 关闭日志记录器\n  public close(): void {\n    if (this.flushInterval) {\n      clearInterval(this.flushInterval);\n      this.flushInterval = null;\n    }\n    \n    // 刷新剩余日志\n    this.flushLogQueue();\n  }\n}\n\n// 创建默认日志记录器实例\nexport const securityLogger = new SecurityLogger();\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 712, "column": 0}, "map": {"version":3,"sources":["file:///D:/MyBlog/LoveandJoy/src/app/api/auth/login/route.ts"],"sourcesContent":["import { NextResponse } from 'next/server';\r\nimport jwt from 'jsonwebtoken';\r\nimport bcrypt from 'bcrypt';\r\nimport { z } from 'zod';\r\nimport { executeQuery } from '@/lib/db-pool';\r\nimport { handleApiError, AppError, ErrorCode, createErrorResponse } from '@/utils/error-handler';\r\nimport { securityLogger, LogType } from '@/utils/security-logger';\r\n\r\n// 登录请求的输入验证schema\r\nconst loginSchema = z.object({\r\n  email: z.string().email('请输入有效的邮箱地址'),\r\n  password: z.string().min(6, '密码长度不能少于6个字符')\r\n});\r\n\r\n// 生成JWT令牌\r\nfunction generateToken(userId: number, email: string, role: string) {\r\n  // 使用环境变量或安全的密钥\r\n  const secretKey = process.env.JWT_SECRET || 'your-secret-key';\r\n  const expiresIn = '2h'; // 令牌过期时间\r\n  \r\n  return jwt.sign(\r\n    { userId, email, role },\r\n    secretKey,\r\n    { expiresIn }\r\n  );\r\n}\r\n\r\n// 登录接口\r\nexport async function POST(request: Request) {\r\n  // 获取客户端IP和User-Agent\r\n  const ipAddress = request.headers.get('x-forwarded-for') || 'unknown';\r\n  const userAgent = request.headers.get('user-agent') || 'unknown';\r\n  \r\n  return handleApiError(async () => {\r\n    const body = await request.json();\r\n    \r\n    // 使用zod验证请求参数\r\n    const validatedData = loginSchema.parse(body);\r\n    const { email, password } = validatedData;\r\n    \r\n    // 查询用户\r\n    const [rows] = await executeQuery(\r\n      'SELECT id, name, email, password, usernameId, avatar, role FROM user WHERE email = ?',\r\n      [email]\r\n    );\r\n    \r\n    // 检查用户是否存在\r\n    const users = rows as any[];\r\n    if (users.length === 0) {\r\n      // 记录登录失败日志\r\n      securityLogger.logAuthentication(\r\n        '登录失败：用户不存在',\r\n        {\r\n          ipAddress,\r\n          userAgent,\r\n          action: 'LOGIN',\r\n          status: 'FAILURE',\r\n          details: { email }\r\n        }\r\n      );\r\n      \r\n      throw new AppError(ErrorCode.AUTHENTICATION_ERROR, '账号不存在');\r\n    }\r\n    \r\n    const user = users[0];\r\n    \r\n    // 验证密码 - 兼容明文密码和bcrypt加密密码\n    let isPasswordValid = false;\n    \n    // 检查密码是否为bcrypt加密格式\n    if (user.password.startsWith('$2b$')) {\n      // 使用bcrypt验证\n      isPasswordValid = await bcrypt.compare(password, user.password);\n    } else {\n      // 直接比较明文密码（兼容旧数据）\n      isPasswordValid = password === user.password;\n      \n      // 如果验证成功，将明文密码转换为bcrypt加密格式并更新到数据库\n      if (isPasswordValid) {\n        const hashedPassword = await bcrypt.hash(password, 10);\n        await executeQuery(\n          'UPDATE user SET password = ? WHERE id = ?',\n          [hashedPassword, user.id]\n        );\n      }\n    }\n    \n    if (!isPasswordValid) {\n      // 记录登录失败日志\n      securityLogger.logAuthentication(\n        '登录失败：密码错误',\n        {\n          userId: user.id.toString(),\n          username: user.name,\n          ipAddress,\n          userAgent,\n          action: 'LOGIN',\n          status: 'FAILURE',\n          details: { email }\n        }\n      );\n      \n      throw new AppError(ErrorCode.AUTHENTICATION_ERROR, '密码错误');\n    }\r\n    \r\n    // 更新用户的最后登录时间\r\n    await executeQuery(\r\n      'UPDATE user SET lastLoginAt = NOW() WHERE id = ?',\r\n      [user.id]\r\n    );\r\n    \r\n    // 生成JWT令牌\r\n    const token = generateToken(user.id, user.email, user.role);\r\n    \r\n    // 构建响应数据\r\n    const userInfo = {\r\n      id: user.id,\r\n      name: user.name,\r\n      email: user.email,\r\n      usernameId: user.usernameId,\r\n      avatar: user.avatar,\r\n      role: user.role\r\n    };\r\n    \r\n    // 记录登录成功日志\r\n    securityLogger.logAuthentication(\r\n      '登录成功',\r\n      {\r\n        userId: user.id.toString(),\r\n        username: user.name,\r\n        ipAddress,\r\n        userAgent,\r\n        action: 'LOGIN',\r\n        status: 'SUCCESS',\r\n        details: { email, role: user.role }\r\n      }\r\n    );\r\n    \r\n    // 记录API调用日志\r\n    securityLogger.logApiCall(\r\n      '登录API调用成功',\r\n      {\r\n        userId: user.id.toString(),\r\n        username: user.name,\r\n        ipAddress,\r\n        userAgent,\r\n        action: 'POST',\r\n        resource: '/api/auth/login',\r\n        status: 'SUCCESS',\r\n        details: { email }\r\n      }\r\n    );\r\n    \r\n    // 返回成功响应\r\n    return NextResponse.json({\r\n      success: true,\r\n      data: {\r\n        token,\r\n        userInfo\r\n      },\r\n      message: '登录成功'\r\n    }, { status: 200 });\r\n  });\r\n}\r\n"],"names":[],"mappings":"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"}}]
}