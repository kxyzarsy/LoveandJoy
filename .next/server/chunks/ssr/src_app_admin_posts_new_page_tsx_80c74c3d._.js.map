{"version":3,"sources":["../../../../src/app/admin/posts/new/page.tsx"],"sourcesContent":["'use client'\r\n\r\nimport { useState, useEffect } from 'react'\r\nimport { useRouter } from 'next/navigation'\r\nimport { hasSensitiveWords, detectSensitiveWords } from '../../../../utils/违禁词检测'\r\n\r\nconst categories = [\r\n  { id: 1, name: '技术', slug: 'tech' },\r\n  { id: 2, name: '生活', slug: 'life' },\r\n  { id: 3, name: '学习', slug: 'study' },\r\n  { id: 4, name: '工作', slug: 'work' },\r\n]\r\n\r\nexport default function NewPostPage() {\r\n  const router = useRouter()\r\n  const [title, setTitle] = useState('')\r\n  const [excerpt, setExcerpt] = useState('')\r\n  const [content, setContent] = useState('')\r\n  const [categoryId, setCategoryId] = useState(1)\r\n  const [image, setImage] = useState('')\r\n  const [isLoading, setIsLoading] = useState(false)\r\n  const [error, setError] = useState('')\r\n  const [success, setSuccess] = useState('')\r\n  const [showSuccessAnimation, setShowSuccessAnimation] = useState(false)\r\n  const [showWarning, setShowWarning] = useState(false)\r\n  const [hasSensitiveContent, setHasSensitiveContent] = useState(false)\r\n\r\n  // 检查登录状态\r\n  useEffect(() => {\r\n    const isLoggedIn = localStorage.getItem('isLoggedIn') === 'true'\r\n    const user = JSON.parse(localStorage.getItem('user') || 'null')\r\n    \r\n    // 如果未登录或不是管理员，重定向到登录页面\r\n    if (!isLoggedIn || !user) {\r\n      router.push('/login')\r\n      return\r\n    }\r\n  }, [router])\r\n\r\n  const handleSubmit = async (e: React.FormEvent<HTMLFormElement>) => {\r\n    e.preventDefault()\r\n    setIsLoading(true)\r\n    setError('')\r\n    setSuccess('')\r\n    setShowSuccessAnimation(false)\r\n    setShowWarning(false)\r\n    setHasSensitiveContent(false)\r\n\r\n    try {\r\n      // 简单的表单验证\r\n      if (title && excerpt && content) {\r\n        // 检测违禁词\r\n        const allText = `${title} ${excerpt} ${content}`\r\n        const hasSensitive = hasSensitiveWords(allText)\r\n        const foundWords = detectSensitiveWords(allText)\r\n        \r\n        // 模拟发布文章请求\r\n        await new Promise(resolve => setTimeout(resolve, 1000))\r\n        \r\n        // 设置文章状态\r\n        const status = hasSensitive ? 'pending' : 'published'\r\n        \r\n        // 这里可以添加实际的发布文章逻辑\r\n\r\n        // 调用API发布文章\r\n        const newPostData = {\r\n          title,\r\n          excerpt,\r\n          content,\r\n          categoryId,\r\n          image,\r\n          status,\r\n          foundSensitiveWords: foundWords,\r\n          createdAt: new Date().toISOString(),\r\n          authorId: 1, // 假设当前用户ID为1\r\n          reviewedBy: null,\r\n          reviewedAt: null,\r\n          rejectionReason: null,\r\n          likes: 0 // 添加点赞数字段，默认为0\r\n        }\r\n        \r\n        // 调用API路由发布文章\r\n        const response = await fetch('/api/posts', {\r\n          method: 'POST',\r\n          headers: {\r\n            'Content-Type': 'application/json',\r\n          },\r\n          body: JSON.stringify(newPostData),\r\n        })\r\n        \r\n        if (!response.ok) {\r\n          throw new Error('发布文章失败')\r\n        }\r\n        \r\n        const newPost = await response.json()\r\n        \r\n        // 显示发布成功动画\r\n        setShowSuccessAnimation(true)\r\n        \r\n        // 保存敏感内容状态\r\n        setHasSensitiveContent(hasSensitive)\r\n        \r\n        // 动画结束后显示反馈信息\r\n        setTimeout(() => {\r\n          // 显示成功信息\r\n          setSuccess('文章已成功发布')\r\n          \r\n          // 如果含有违禁词，显示警告信息\r\n          if (hasSensitive) {\r\n            setShowWarning(true)\r\n          }\r\n          \r\n          // 根据文章状态跳转\r\n          if (hasSensitive) {\r\n            // 跳转到个人主页\r\n            setTimeout(() => {\r\n              router.push('/users/1')\r\n            }, 3000)\r\n          } else {\r\n            // 跳转到文章详情页\r\n            setTimeout(() => {\r\n              router.push(`/posts/${newPost.id}`)\r\n            }, 2000)\r\n          }\r\n        }, 1500)\r\n      } else {\r\n        setError('请填写所有必填字段')\r\n      }\r\n    } catch (err) {\r\n      setError('发布文章失败，请重试')\r\n    } finally {\r\n      setIsLoading(false)\r\n    }\r\n  }\r\n\r\n  return (\r\n    <div className=\"max-w-4xl mx-auto\">\r\n      <div className=\"flex justify-between items-center mb-8\">\r\n        <h1 className=\"text-3xl font-bold text-gray-900\">发布新文章</h1>\r\n        <button\r\n          onClick={() => router.back()}\r\n          className=\"px-4 py-2 bg-gray-200 hover:bg-gray-300 text-gray-800 rounded-md transition-colors\"\r\n        >\r\n          返回\r\n        </button>\r\n      </div>\r\n\r\n      {/* 错误信息 */}\r\n      {error && (\r\n        <div className=\"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-md mb-6\">\r\n          {error}\r\n        </div>\r\n      )}\r\n      \r\n      {/* 发布成功动画 */}\r\n      {showSuccessAnimation && (\r\n        <div className=\"flex justify-center items-center mb-6 py-12\">\r\n          <div className=\"relative\">\r\n            {/* 圆形进度动画 */}\r\n            <div className=\"w-24 h-24 border-4 border-blue-200 border-t-blue-600 rounded-full animate-spin mb-4\"></div>\r\n            {/* 成功图标 */}\r\n            <div className=\"absolute inset-0 flex items-center justify-center\">\r\n              <svg className=\"w-12 h-12 text-green-500 animate-pulse\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M5 13l4 4L19 7\" />\r\n              </svg>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n      \r\n      {/* 成功信息 */}\r\n      {success && (\r\n        <div className=\"bg-green-50 border border-green-200 text-green-700 px-4 py-3 rounded-md mb-4\">\r\n          <div className=\"flex items-center gap-2\">\r\n            <svg className=\"w-5 h-5 text-green-500\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M5 13l4 4L19 7\" />\r\n            </svg>\r\n            <span>{success}</span>\r\n          </div>\r\n        </div>\r\n      )}\r\n      \r\n      {/* 违禁词警告信息 */}\r\n      {showWarning && (\r\n        <div className=\"bg-yellow-50 border border-yellow-200 text-yellow-700 px-4 py-3 rounded-md mb-6\">\r\n          <div className=\"flex items-center gap-2\">\r\n            <svg className=\"w-5 h-5 text-yellow-500\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z\" />\r\n            </svg>\r\n            <span>该文章含有违禁词，需要通过审核才能正常发布</span>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      <form className=\"space-y-6\" onSubmit={handleSubmit}>\r\n        <div>\r\n          <label htmlFor=\"title\" className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n            文章标题\r\n          </label>\r\n          <input\r\n            id=\"title\"\r\n            name=\"title\"\r\n            type=\"text\"\r\n            required\r\n            className=\"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\r\n            placeholder=\"请输入文章标题\"\r\n            value={title}\r\n            onChange={(e) => setTitle(e.target.value)}\r\n          />\r\n        </div>\r\n\r\n        <div>\r\n          <label htmlFor=\"excerpt\" className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n            文章摘要\r\n          </label>\r\n          <textarea\r\n            id=\"excerpt\"\r\n            name=\"excerpt\"\r\n            rows={3}\r\n            required\r\n            className=\"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none\"\r\n            placeholder=\"请输入文章摘要\"\r\n            value={excerpt}\r\n            onChange={(e) => setExcerpt(e.target.value)}\r\n          ></textarea>\r\n        </div>\r\n\r\n        <div>\r\n          <label htmlFor=\"content\" className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n            文章内容\r\n          </label>\r\n          <textarea\r\n            id=\"content\"\r\n            name=\"content\"\r\n            rows={10}\r\n            required\r\n            className=\"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none\"\r\n            placeholder=\"请输入文章内容\"\r\n            value={content}\r\n            onChange={(e) => setContent(e.target.value)}\r\n          ></textarea>\r\n        </div>\r\n\r\n        <div>\r\n          <label htmlFor=\"category\" className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n            文章分类\r\n          </label>\r\n          <select\r\n            id=\"category\"\r\n            name=\"category\"\r\n            required\r\n            className=\"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\r\n            value={categoryId}\r\n            onChange={(e) => setCategoryId(parseInt(e.target.value))}\r\n          >\r\n            {categories.map((category) => (\r\n              <option key={category.id} value={category.id}>\r\n                {category.name}\r\n              </option>\r\n            ))}\r\n          </select>\r\n        </div>\r\n\r\n        <div>\r\n          <label htmlFor=\"image\" className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n            文章图片 URL\r\n          </label>\r\n          <input\r\n            id=\"image\"\r\n            name=\"image\"\r\n            type=\"url\"\r\n            className=\"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\r\n            placeholder=\"请输入文章图片 URL\"\r\n            value={image}\r\n            onChange={(e) => setImage(e.target.value)}\r\n          />\r\n        </div>\r\n\r\n        <div className=\"flex justify-end\">\r\n          <button\r\n            type=\"submit\"\r\n            disabled={isLoading}\r\n            className=\"px-6 py-3 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium transition-colors disabled:opacity-70 disabled:cursor-not-allowed\"\r\n          >\r\n            {isLoading ? '发布中...' : '发布文章'}\r\n          </button>\r\n        </div>\r\n      </form>\r\n    </div>\r\n  )\r\n}"],"names":[],"mappings":"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"}