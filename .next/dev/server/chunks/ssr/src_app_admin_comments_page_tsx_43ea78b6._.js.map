{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///D:/MyBlog/LoveandJoy/src/app/admin/comments/page.tsx"],"sourcesContent":["'use client'\r\n\r\nimport React, { useState, useEffect } from 'react'\r\nimport { useRouter } from 'next/navigation'\r\nimport Link from 'next/link'\r\nimport { adminAuth, listenToAdminStateChanges } from '@/utils/admin-state-manager'\r\n\r\n// 评论类型\r\ninterface Comment {\r\n  id: number\r\n  content: string\r\n  createdAt: string\r\n  author: {\r\n    id: number\r\n    name: string\r\n    avatar: string\r\n  }\r\n  post: {\r\n    id: number\r\n    title: string\r\n  }\r\n  isApproved: boolean\r\n}\r\n\r\n// 模拟评论数据\r\nconst mockComments: Comment[] = [\r\n  {\r\n    id: 1,\r\n    content: '这是一条很好的评论，内容很有价值！',\r\n    createdAt: new Date().toISOString(),\r\n    author: {\r\n      id: 2,\r\n      name: '用户1',\r\n      avatar: 'https://via.placeholder.com/100'\r\n    },\r\n    post: {\r\n      id: 1,\r\n      title: '欢迎来到我的博客'\r\n    },\r\n    isApproved: true\r\n  },\r\n  {\r\n    id: 2,\r\n    content: '我有不同的看法，我认为...',\r\n    createdAt: new Date(Date.now() - 3600000).toISOString(),\r\n    author: {\r\n      id: 3,\r\n      name: '用户2',\r\n      avatar: 'https://via.placeholder.com/100'\r\n    },\r\n    post: {\r\n      id: 2,\r\n      title: 'Next.js 入门指南'\r\n    },\r\n    isApproved: true\r\n  },\r\n  {\r\n    id: 3,\r\n    content: '这篇文章写得真好，学到了很多！',\r\n    createdAt: new Date(Date.now() - 7200000).toISOString(),\r\n    author: {\r\n      id: 4,\r\n      name: '用户3',\r\n      avatar: 'https://via.placeholder.com/100'\r\n    },\r\n    post: {\r\n      id: 1,\r\n      title: '欢迎来到我的博客'\r\n    },\r\n    isApproved: false\r\n  },\r\n  {\r\n    id: 4,\r\n    content: '期待更多这样的内容！',\r\n    createdAt: new Date(Date.now() - 10800000).toISOString(),\r\n    author: {\r\n      id: 5,\r\n      name: '用户4',\r\n      avatar: 'https://via.placeholder.com/100'\r\n    },\r\n    post: {\r\n      id: 3,\r\n      title: 'Tailwind CSS 实用技巧'\r\n    },\r\n    isApproved: true\r\n  }\r\n]\r\n\r\nexport default function AdminCommentsPage() {\r\n  const router = useRouter()\r\n  const [comments, setComments] = useState<Comment[]>(mockComments)\r\n  const [searchTerm, setSearchTerm] = useState('')\r\n  const [filteredComments, setFilteredComments] = useState<Comment[]>(mockComments)\r\n  const [success, setSuccess] = useState('')\r\n\r\n  // 检查登录状态\r\n  useEffect(() => {\r\n    const checkAuth = () => {\r\n      const isLoggedIn = adminAuth.isAuthenticated()\r\n      const user = adminAuth.getCurrentUser()\r\n      \r\n      // 如果未登录或不是管理员，重定向到管理员登录页面\r\n      if (!isLoggedIn || !user || user.role !== 'admin') {\r\n        router.push('/admin/secret-login')\r\n        return\r\n      }\r\n    }\r\n    \r\n    // 初始检查\r\n    checkAuth()\r\n    \r\n    // 监听管理员状态变化\r\n    const cleanup = listenToAdminStateChanges(checkAuth)\r\n    \r\n    return cleanup\r\n  }, [router])\r\n\r\n  // 搜索功能\r\n  useEffect(() => {\r\n    if (searchTerm.trim() === '') {\r\n      setFilteredComments(comments)\r\n    } else {\r\n      const term = searchTerm.toLowerCase()\r\n      const filtered = comments.filter(comment => \r\n        comment.content.toLowerCase().includes(term) ||\r\n        comment.author.name.toLowerCase().includes(term) ||\r\n        comment.post.title.toLowerCase().includes(term)\r\n      )\r\n      setFilteredComments(filtered)\r\n    }\r\n  }, [searchTerm, comments])\r\n\r\n  // 切换评论审核状态\r\n  const toggleApprove = (commentId: number) => {\r\n    const updatedComments = comments.map(comment => {\r\n      if (comment.id === commentId) {\r\n        return {\r\n          ...comment,\r\n          isApproved: !comment.isApproved\r\n        }\r\n      }\r\n      return comment\r\n    })\r\n    setComments(updatedComments)\r\n    setFilteredComments(updatedComments)\r\n    setSuccess('评论状态已更新')\r\n    \r\n    // 3秒后清除成功信息\r\n    setTimeout(() => setSuccess(''), 3000)\r\n  }\r\n\r\n  // 删除评论\r\n  const handleDelete = (commentId: number) => {\r\n    if (confirm('确定要删除这条评论吗？')) {\r\n      const updatedComments = comments.filter(comment => comment.id !== commentId)\r\n      setComments(updatedComments)\r\n      setFilteredComments(updatedComments)\r\n      setSuccess('评论已删除')\r\n      \r\n      // 3秒后清除成功信息\r\n      setTimeout(() => setSuccess(''), 3000)\r\n    }\r\n  }\r\n\r\n  return (\r\n    <div className=\"min-h-[calc(100vh-200px)] bg-gray-50\">\r\n      <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8\">\r\n        {/* 页面标题 */}\r\n        <div className=\"flex justify-between items-center mb-8\">\r\n          <h1 className=\"text-3xl font-bold text-gray-900\">评论管理</h1>\r\n          <div className=\"flex items-center gap-4\">\r\n            <Link \r\n              href=\"/admin\" \r\n              className=\"px-4 py-2 bg-gray-600 hover:bg-gray-700 text-white rounded-md text-sm font-medium transition-colors\"\r\n            >\r\n              返回后台\r\n            </Link>\r\n          </div>\r\n        </div>\r\n\r\n        {/* 成功信息 */}\r\n        {success && (\r\n          <div className=\"bg-green-50 border border-green-200 text-green-700 px-4 py-3 rounded-md mb-6\">\r\n            {success}\r\n          </div>\r\n        )}\r\n\r\n        {/* 搜索栏 */}\r\n        <div className=\"mb-8\">\r\n          <div className=\"relative\">\r\n            <input\r\n              type=\"text\"\r\n              placeholder=\"搜索评论内容、用户名或文章标题...\"\r\n              className=\"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\r\n              value={searchTerm}\r\n              onChange={(e) => setSearchTerm(e.target.value)}\r\n            />\r\n            <div className=\"absolute right-3 top-3\">\r\n              <svg className=\"w-5 h-5 text-gray-400\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z\" />\r\n              </svg>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        {/* 评论列表 */}\r\n        <div className=\"bg-white rounded-xl shadow-md overflow-hidden\">\r\n          <div className=\"overflow-x-auto\">\r\n            <table className=\"min-w-full divide-y divide-gray-200\">\r\n              <thead className=\"bg-gray-50\">\r\n                <tr>\r\n                  <th scope=\"col\" className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\r\n                    ID\r\n                  </th>\r\n                  <th scope=\"col\" className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\r\n                    评论内容\r\n                  </th>\r\n                  <th scope=\"col\" className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\r\n                    作者\r\n                  </th>\r\n                  <th scope=\"col\" className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\r\n                    文章\r\n                  </th>\r\n                  <th scope=\"col\" className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\r\n                    发布时间\r\n                  </th>\r\n                  <th scope=\"col\" className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\r\n                    状态\r\n                  </th>\r\n                  <th scope=\"col\" className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\r\n                    操作\r\n                  </th>\r\n                </tr>\r\n              </thead>\r\n              <tbody className=\"bg-white divide-y divide-gray-200\">\r\n                {filteredComments.map((comment) => (\r\n                  <tr key={comment.id}>\r\n                    <td className=\"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900\">\r\n                      {comment.id}\r\n                    </td>\r\n                    <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-600\">\r\n                      <div className=\"line-clamp-2\">{comment.content}</div>\r\n                    </td>\r\n                    <td className=\"px-6 py-4 whitespace-nowrap\">\r\n                      <div className=\"flex items-center\">\r\n                        <div className=\"w-8 h-8 rounded-full overflow-hidden mr-2\">\r\n                          <img\r\n                            src={comment.author.avatar}\r\n                            alt={comment.author.name}\r\n                            className=\"w-full h-full object-cover\"\r\n                          />\r\n                        </div>\r\n                        <span className=\"text-sm font-medium text-gray-900\">{comment.author.name}</span>\r\n                      </div>\r\n                    </td>\r\n                    <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-500\">\r\n                      <Link href={`/posts/${comment.post.id}`} className=\"text-blue-600 hover:underline\">\r\n                        {comment.post.title}\r\n                      </Link>\r\n                    </td>\r\n                    <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-500\">\r\n                      {new Date(comment.createdAt).toLocaleString()}\r\n                    </td>\r\n                    <td className=\"px-6 py-4 whitespace-nowrap\">\r\n                      <span className={`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${comment.isApproved ? 'bg-green-100 text-green-800' : 'bg-yellow-100 text-yellow-800'}`}>\r\n                        {comment.isApproved ? '已审核' : '待审核'}\r\n                      </span>\r\n                    </td>\r\n                    <td className=\"px-6 py-4 whitespace-nowrap text-sm font-medium\">\r\n                      <div className=\"flex gap-2\">\r\n                        <button\r\n                          onClick={() => toggleApprove(comment.id)}\r\n                          className={`${comment.isApproved ? 'text-yellow-600 hover:text-yellow-900' : 'text-green-600 hover:text-green-900'}`}\r\n                        >\r\n                          {comment.isApproved ? '取消审核' : '审核通过'}\r\n                        </button>\r\n                        <button\r\n                          onClick={() => handleDelete(comment.id)}\r\n                          className=\"text-red-600 hover:text-red-900\"\r\n                        >\r\n                          删除\r\n                        </button>\r\n                      </div>\r\n                    </td>\r\n                  </tr>\r\n                ))}\r\n              </tbody>\r\n            </table>\r\n          </div>\r\n          \r\n          {/* 空状态 */}\r\n          {filteredComments.length === 0 && (\r\n            <div className=\"px-6 py-12 text-center\">\r\n              <svg className=\"w-12 h-12 text-gray-400 mx-auto mb-4\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z\" />\r\n              </svg>\r\n              <h3 className=\"text-lg font-medium text-gray-900 mb-2\">没有找到评论</h3>\r\n              <p className=\"text-sm text-gray-500\">\r\n                {searchTerm ? '尝试调整搜索条件' : '还没有评论'}\r\n              </p>\r\n            </div>\r\n          )}\r\n        </div>\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n"],"names":[],"mappings":"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"}}]
}