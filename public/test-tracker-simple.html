<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç”¨æˆ·æ“ä½œè®°å½•è„šæœ¬ - ç®€å•æµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
        }
        .container {
            background-color: #f5f5f5;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .test-section {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        h1, h2 {
            color: #333;
        }
        button {
            background-color: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 16px;
            margin: 5px;
            cursor: pointer;
            border-radius: 4px;
        }
        button:hover {
            background-color: #45a049;
        }
        button.secondary {
            background-color: #008CBA;
        }
        button.secondary:hover {
            background-color: #007B9E;
        }
        button.danger {
            background-color: #f44336;
        }
        button.danger:hover {
            background-color: #da190b;
        }
        .log-container {
            background-color: #f0f0f0;
            padding: 10px;
            border-radius: 4px;
            margin-top: 20px;
            max-height: 300px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 14px;
        }
        .log-entry {
            margin-bottom: 5px;
            padding: 5px;
            border-radius: 3px;
        }
        .log-entry.info {
            background-color: #e3f2fd;
            color: #1565c0;
        }
        .log-entry.success {
            background-color: #e8f5e8;
            color: #2e7d32;
        }
        .log-entry.error {
            background-color: #ffebee;
            color: #c62828;
        }
        .log-entry.warning {
            background-color: #fff8e1;
            color: #f57f17;
        }
        .test-result {
            margin-top: 20px;
            padding: 15px;
            border-radius: 8px;
            font-weight: bold;
        }
        .test-result.pass {
            background-color: #e8f5e8;
            color: #2e7d32;
        }
        .test-result.fail {
            background-color: #ffebee;
            color: #c62828;
        }
    </style>
</head>
<body>
    <h1>ğŸ“Š ç”¨æˆ·æ“ä½œè®°å½•è„šæœ¬ - ç®€å•æµ‹è¯•</h1>
    
    <div class="container">
        <h2>ğŸ’¡ æµ‹è¯•è¯´æ˜</h2>
        <p>æœ¬é¡µé¢ç”¨äºç®€å•æµ‹è¯•ç”¨æˆ·æ“ä½œè®°å½•è„šæœ¬çš„æ ¸å¿ƒåŠŸèƒ½ã€‚é¡µé¢ä¼šè‡ªåŠ¨è¿è¡Œä¸€ç³»åˆ—æµ‹è¯•ï¼Œæµ‹è¯•ç»“æœå°†æ˜¾ç¤ºåœ¨ä¸‹æ–¹ã€‚</p>
    </div>
    
    <div class="test-section">
        <h2>ğŸ® æµ‹è¯•æ§åˆ¶</h2>
        <button onclick="runAllTests()">è¿è¡Œæ‰€æœ‰æµ‹è¯•</button>
        <button onclick="clearLogs()">æ¸…é™¤æ—¥å¿—</button>
        <button onclick="window.userOperationTracker.destroy()">é”€æ¯è„šæœ¬</button>
    </div>
    
    <div class="test-section">
        <h2>ğŸ“‹ æµ‹è¯•æ—¥å¿—</h2>
        <div id="log-container" class="log-container">
            <div class="log-entry info">â„¹ï¸ é¡µé¢å·²åŠ è½½ï¼Œè„šæœ¬å·²åˆå§‹åŒ–ã€‚ç‚¹å‡»"è¿è¡Œæ‰€æœ‰æµ‹è¯•"æŒ‰é’®å¼€å§‹æµ‹è¯•ã€‚</div>
        </div>
    </div>
    
    <div class="test-section">
        <h2>âœ… æµ‹è¯•ç»“æœ</h2>
        <div id="test-result" class="test-result">
            ç­‰å¾…æµ‹è¯•è¿è¡Œ...
        </div>
    </div>
    
    <!-- æµ‹è¯•å…ƒç´  -->
    <div class="test-section" style="display: none;">
        <h2>ğŸ” æµ‹è¯•å…ƒç´ ï¼ˆéšè—ï¼‰</h2>
        <button id="test-btn1" class="test-btn">æµ‹è¯•æŒ‰é’®1</button>
        <button id="test-btn2" class="test-btn">æµ‹è¯•æŒ‰é’®2</button>
        <input type="text" id="test-input" class="test-input" placeholder="æµ‹è¯•è¾“å…¥æ¡†">
        <div id="test-div" class="test-div">æµ‹è¯•divå…ƒç´ </div>
    </div>
    
    <!-- å¼•å…¥ç”¨æˆ·æ“ä½œè®°å½•è„šæœ¬ -->
    <script src="/user-operation-tracker.js"></script>
    
    <script>
        // æµ‹è¯•ç»“æœ
        let testResults = {
            total: 0,
            passed: 0,
            failed: 0,
            tests: []
        };
        
        // è‡ªå®šä¹‰æ—¥å¿—å‡½æ•°
        function log(message, type = 'info') {
            const logContainer = document.getElementById('log-container');
            const logEntry = document.createElement('div');
            logEntry.className = `log-entry ${type}`;
            logEntry.textContent = `${new Date().toLocaleTimeString()} - ${message}`;
            logContainer.appendChild(logEntry);
            logContainer.scrollTop = logContainer.scrollHeight;
        }
        
        // æ¸…é™¤æ—¥å¿—
        function clearLogs() {
            const logContainer = document.getElementById('log-container');
            logContainer.innerHTML = '<div class="log-entry info">â„¹ï¸ æ—¥å¿—å·²æ¸…é™¤ã€‚</div>';
            testResults = {
                total: 0,
                passed: 0,
                failed: 0,
                tests: []
            };
            updateTestResult();
        }
        
        // æ›´æ–°æµ‹è¯•ç»“æœæ˜¾ç¤º
        function updateTestResult() {
            const resultDiv = document.getElementById('test-result');
            const percentage = testResults.total > 0 ? Math.round((testResults.passed / testResults.total) * 100) : 0;
            
            let resultText = `æµ‹è¯•å®Œæˆï¼š${testResults.passed}/${testResults.total} ä¸ªæµ‹è¯•é€šè¿‡ (${percentage}%)`;
            let resultClass = 'pass';
            
            if (testResults.failed > 0) {
                resultClass = 'fail';
            }
            
            resultDiv.className = `test-result ${resultClass}`;
            resultDiv.textContent = resultText;
        }
        
        // è¿è¡Œå•ä¸ªæµ‹è¯•
        async function runTest(testName, testFunction) {
            testResults.total++;
            log(`ğŸ“Œ å¼€å§‹æµ‹è¯•ï¼š${testName}`);
            
            try {
                await testFunction();
                log(`âœ… æµ‹è¯•é€šè¿‡ï¼š${testName}`);
                testResults.passed++;
                testResults.tests.push({ name: testName, status: 'pass' });
            } catch (error) {
                log(`âŒ æµ‹è¯•å¤±è´¥ï¼š${testName} - ${error.message}`);
                testResults.failed++;
                testResults.tests.push({ name: testName, status: 'fail', error: error.message });
            }
            
            updateTestResult();
        }
        
        // æµ‹è¯•1ï¼šè„šæœ¬åˆå§‹åŒ–
        async function testScriptInitialization() {
            if (typeof window.userOperationTracker === 'undefined') {
                throw new Error('è„šæœ¬æœªåˆå§‹åŒ–');
            }
            
            if (typeof window.userOperationTracker.start !== 'function') {
                throw new Error('ç¼ºå°‘startæ–¹æ³•');
            }
            
            if (typeof window.userOperationTracker.stop !== 'function') {
                throw new Error('ç¼ºå°‘stopæ–¹æ³•');
            }
            
            if (typeof window.userOperationTracker.exportData !== 'function') {
                throw new Error('ç¼ºå°‘exportDataæ–¹æ³•');
            }
            
            if (typeof window.userOperationTracker.playback !== 'function') {
                throw new Error('ç¼ºå°‘playbackæ–¹æ³•');
            }
            
            if (typeof window.userOperationTracker.destroy !== 'function') {
                throw new Error('ç¼ºå°‘destroyæ–¹æ³•');
            }
        }
        
        // æµ‹è¯•2ï¼šå¼€å§‹å’Œåœæ­¢è®°å½•
        async function testStartStop() {
            // å¼€å§‹è®°å½•
            window.userOperationTracker.start();
            
            // æ¨¡æ‹Ÿç‚¹å‡»æ“ä½œ
            document.getElementById('test-btn1').click();
            
            // åœæ­¢è®°å½•
            window.userOperationTracker.stop();
            
            // æ£€æŸ¥æ˜¯å¦æœ‰æ“ä½œè®°å½•
            const status = window._userOperationTrackerInstance.getStatus();
            if (status.operationCount === 0) {
                throw new Error('æ²¡æœ‰è®°å½•åˆ°æ“ä½œ');
            }
        }
        
        // æµ‹è¯•3ï¼šè®°å½•ç‚¹å‡»æ“ä½œ
        async function testClickRecording() {
            // æ¸…é™¤ä¹‹å‰çš„æ•°æ®
            window.userOperationTracker.clearData();
            
            // å¼€å§‹è®°å½•
            window.userOperationTracker.start();
            
            // æ¨¡æ‹Ÿç‚¹å‡»æ“ä½œ
            const btn1 = document.getElementById('test-btn1');
            const btn2 = document.getElementById('test-btn2');
            
            btn1.click();
            btn2.click();
            btn1.click();
            
            // åœæ­¢è®°å½•
            window.userOperationTracker.stop();
            
            // æ£€æŸ¥æ“ä½œè®°å½•
            const status = window._userOperationTrackerInstance.getStatus();
            if (status.operationCount < 3) {
                throw new Error('ç‚¹å‡»æ“ä½œè®°å½•ä¸å®Œæ•´');
            }
        }
        
        // æµ‹è¯•4ï¼šè®°å½•é”®ç›˜æ“ä½œ
        async function testKeyboardRecording() {
            // æ¸…é™¤ä¹‹å‰çš„æ•°æ®
            window.userOperationTracker.clearData();
            
            // å¼€å§‹è®°å½•
            window.userOperationTracker.start();
            
            // æ¨¡æ‹Ÿé”®ç›˜æ“ä½œ
            const input = document.getElementById('test-input');
            input.focus();
            
            // æ¨¡æ‹Ÿè¾“å…¥æ–‡æœ¬
            input.value = 'test';
            
            // è§¦å‘inputäº‹ä»¶
            const inputEvent = new Event('input', { bubbles: true });
            input.dispatchEvent(inputEvent);
            
            // åœæ­¢è®°å½•
            window.userOperationTracker.stop();
            
            // æ£€æŸ¥æ“ä½œè®°å½•
            const status = window._userOperationTrackerInstance.getStatus();
            if (status.operationCount === 0) {
                throw new Error('æ²¡æœ‰è®°å½•åˆ°é”®ç›˜æ“ä½œ');
            }
        }
        
        // æµ‹è¯•5ï¼šæ¸…é™¤æ•°æ®
        async function testClearData() {
            // å…ˆè®°å½•ä¸€äº›æ“ä½œ
            window.userOperationTracker.start();
            document.getElementById('test-btn1').click();
            window.userOperationTracker.stop();
            
            // æ£€æŸ¥æ˜¯å¦æœ‰æ“ä½œè®°å½•
            let status = window._userOperationTrackerInstance.getStatus();
            if (status.operationCount === 0) {
                throw new Error('æ¸…é™¤æ•°æ®æµ‹è¯•å‰æ²¡æœ‰æ“ä½œè®°å½•');
            }
            
            // æ¸…é™¤æ•°æ®
            window.userOperationTracker.clearData();
            
            // æ£€æŸ¥æ•°æ®æ˜¯å¦å·²æ¸…é™¤
            status = window._userOperationTrackerInstance.getStatus();
            if (status.operationCount !== 0) {
                throw new Error('æ•°æ®æ¸…é™¤å¤±è´¥');
            }
        }
        
        // æµ‹è¯•6ï¼šå¯¼å‡ºæ•°æ®
        async function testExportData() {
            // è®°å½•ä¸€äº›æ“ä½œ
            window.userOperationTracker.clearData();
            window.userOperationTracker.start();
            document.getElementById('test-btn1').click();
            window.userOperationTracker.stop();
            
            // å¯¼å‡ºæ•°æ®
            const exportData = window.userOperationTracker.exportData();
            
            // æ£€æŸ¥å¯¼å‡ºæ•°æ®
            if (!exportData) {
                throw new Error('å¯¼å‡ºæ•°æ®ä¸ºç©º');
            }
            
            if (!exportData.metadata || !exportData.operations) {
                throw new Error('å¯¼å‡ºæ•°æ®æ ¼å¼ä¸æ­£ç¡®');
            }
            
            if (exportData.operations.length === 0) {
                throw new Error('å¯¼å‡ºæ•°æ®ä¸­æ²¡æœ‰æ“ä½œè®°å½•');
            }
        }
        
        // è¿è¡Œæ‰€æœ‰æµ‹è¯•
        async function runAllTests() {
            log('ğŸš€ å¼€å§‹è¿è¡Œæ‰€æœ‰æµ‹è¯•...', 'info');
            
            // é‡ç½®æµ‹è¯•ç»“æœ
            testResults = {
                total: 0,
                passed: 0,
                failed: 0,
                tests: []
            };
            
            // è¿è¡Œæµ‹è¯•
            await runTest('è„šæœ¬åˆå§‹åŒ–', testScriptInitialization);
            await runTest('å¼€å§‹å’Œåœæ­¢è®°å½•', testStartStop);
            await runTest('è®°å½•ç‚¹å‡»æ“ä½œ', testClickRecording);
            await runTest('è®°å½•é”®ç›˜æ“ä½œ', testKeyboardRecording);
            await runTest('æ¸…é™¤æ•°æ®', testClearData);
            await runTest('å¯¼å‡ºæ•°æ®', testExportData);
            
            log('ğŸ‰ æ‰€æœ‰æµ‹è¯•è¿è¡Œå®Œæˆï¼', 'success');
        }
        
        // é¡µé¢åŠ è½½å®Œæˆåè‡ªåŠ¨è¿è¡Œæµ‹è¯•
        window.addEventListener('DOMContentLoaded', function() {
            log('âœ… é¡µé¢åŠ è½½å®Œæˆï¼Œè„šæœ¬å·²åˆå§‹åŒ–', 'success');
            log('ğŸ“Œ 5ç§’åè‡ªåŠ¨å¼€å§‹æµ‹è¯•...', 'info');
            
            // 5ç§’åè‡ªåŠ¨è¿è¡Œæµ‹è¯•
            setTimeout(() => {
                runAllTests();
            }, 5000);
        });
    </script>
</body>
</html>