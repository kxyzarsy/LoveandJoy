{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 15, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/ (unsupported edge import 'stream')"],"sourcesContent":["__turbopack_context__.n(__import_unsupported(`stream`));\n"],"names":[],"mappings":"AAAA,sBAAsB,CAAC,CAAC,qBAAqB,CAAC,MAAM,CAAC"}},
    {"offset": {"line": 25, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/ (unsupported edge import 'crypto')"],"sourcesContent":["__turbopack_context__.n(__import_unsupported(`crypto`));\n"],"names":[],"mappings":"AAAA,sBAAsB,CAAC,CAAC,qBAAqB,CAAC,MAAM,CAAC"}},
    {"offset": {"line": 30, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/src/middleware.ts"],"sourcesContent":["import { NextResponse } from 'next/server';\r\nimport type { NextRequest } from 'next/server';\r\nimport jwt from 'jsonwebtoken';\r\n\r\n// JWT验证中间件\r\nexport function middleware(request: NextRequest) {\r\n  // 不需要验证的路由\r\n  const publicPaths = [\r\n    '/api/auth/login',\r\n    '/api/auth/send-verification-code',\r\n    '/api/posts',\r\n    '/api/footer-config'\r\n  ];\r\n  \r\n  const isPublicPath = publicPaths.some(path => \r\n    request.nextUrl.pathname.startsWith(path) || \r\n    request.nextUrl.pathname === path\r\n  );\r\n  \r\n  // 公开路由直接放行\r\n  if (isPublicPath) {\r\n    return NextResponse.next();\r\n  }\r\n  \r\n  // 从请求头获取Authorization令牌\r\n  const authHeader = request.headers.get('Authorization');\r\n  const token = authHeader?.replace('Bearer ', '');\r\n  \r\n  // 没有令牌，返回401错误\r\n  if (!token) {\r\n    return NextResponse.json({ \r\n      success: false, \r\n      error: '未授权访问',\r\n      message: '请先登录' \r\n    }, { status: 401 });\r\n  }\r\n  \r\n  try {\r\n    // 验证JWT令牌\r\n    const secretKey = process.env.JWT_SECRET || 'your-secret-key';\r\n    const decoded = jwt.verify(token, secretKey) as {\r\n      userId: number;\r\n      email: string;\r\n      role: string;\r\n    };\r\n    \r\n    // 检查是否需要管理员权限\r\n    const adminOnlyPaths = [\r\n      '/api/admin',\r\n      '/api/dashboard-stats',\r\n      '/api/users',\r\n      '/api/comments'\r\n    ];\r\n    \r\n    const requiresAdmin = adminOnlyPaths.some(path => \r\n      request.nextUrl.pathname.startsWith(path)\r\n    );\r\n    \r\n    // 如果需要管理员权限，但用户不是管理员，返回403错误\r\n    if (requiresAdmin && decoded.role !== 'admin') {\r\n      return NextResponse.json({ \r\n        success: false, \r\n        error: '权限不足',\r\n        message: '需要管理员权限才能访问此资源' \r\n      }, { status: 403 });\r\n    }\r\n    \r\n    // 将用户信息添加到请求头中，供后续API路由使用\r\n    const requestHeaders = new Headers(request.headers);\r\n    requestHeaders.set('X-User-Id', decoded.userId.toString());\r\n    requestHeaders.set('X-User-Email', decoded.email);\r\n    requestHeaders.set('X-User-Role', decoded.role);\r\n    \r\n    // 允许请求继续\r\n    return NextResponse.next({ headers: requestHeaders });\r\n  } catch (error) {\r\n    console.error('JWT验证失败:', error);\r\n    \r\n    // 令牌无效或过期，返回401错误\r\n    return NextResponse.json({ \r\n      success: false, \r\n      error: '无效的令牌',\r\n      message: '登录已过期，请重新登录' \r\n    }, { status: 401 });\r\n  }\r\n}\r\n\r\n// 配置中间件应用的路由\r\nexport const config = {\r\n  matcher: '/api/:path*',\r\n};\r\n"],"names":[],"mappings":";;;;;;AAAA;AAAA;AAEA;;;AAGO,SAAS,WAAW,OAAoB;IAC7C,WAAW;IACX,MAAM,cAAc;QAClB;QACA;QACA;QACA;KACD;IAED,MAAM,eAAe,YAAY,IAAI,CAAC,CAAA,OACpC,QAAQ,OAAO,CAAC,QAAQ,CAAC,UAAU,CAAC,SACpC,QAAQ,OAAO,CAAC,QAAQ,KAAK;IAG/B,WAAW;IACX,IAAI,cAAc;QAChB,OAAO,gMAAY,CAAC,IAAI;IAC1B;IAEA,wBAAwB;IACxB,MAAM,aAAa,QAAQ,OAAO,CAAC,GAAG,CAAC;IACvC,MAAM,QAAQ,YAAY,QAAQ,WAAW;IAE7C,eAAe;IACf,IAAI,CAAC,OAAO;QACV,OAAO,gMAAY,CAAC,IAAI,CAAC;YACvB,SAAS;YACT,OAAO;YACP,SAAS;QACX,GAAG;YAAE,QAAQ;QAAI;IACnB;IAEA,IAAI;QACF,UAAU;QACV,MAAM,YAAY,QAAQ,GAAG,CAAC,UAAU,IAAI;QAC5C,MAAM,UAAU,wJAAG,CAAC,MAAM,CAAC,OAAO;QAMlC,cAAc;QACd,MAAM,iBAAiB;YACrB;YACA;YACA;YACA;SACD;QAED,MAAM,gBAAgB,eAAe,IAAI,CAAC,CAAA,OACxC,QAAQ,OAAO,CAAC,QAAQ,CAAC,UAAU,CAAC;QAGtC,6BAA6B;QAC7B,IAAI,iBAAiB,QAAQ,IAAI,KAAK,SAAS;YAC7C,OAAO,gMAAY,CAAC,IAAI,CAAC;gBACvB,SAAS;gBACT,OAAO;gBACP,SAAS;YACX,GAAG;gBAAE,QAAQ;YAAI;QACnB;QAEA,0BAA0B;QAC1B,MAAM,iBAAiB,IAAI,QAAQ,QAAQ,OAAO;QAClD,eAAe,GAAG,CAAC,aAAa,QAAQ,MAAM,CAAC,QAAQ;QACvD,eAAe,GAAG,CAAC,gBAAgB,QAAQ,KAAK;QAChD,eAAe,GAAG,CAAC,eAAe,QAAQ,IAAI;QAE9C,SAAS;QACT,OAAO,gMAAY,CAAC,IAAI,CAAC;YAAE,SAAS;QAAe;IACrD,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,YAAY;QAE1B,kBAAkB;QAClB,OAAO,gMAAY,CAAC,IAAI,CAAC;YACvB,SAAS;YACT,OAAO;YACP,SAAS;QACX,GAAG;YAAE,QAAQ;QAAI;IACnB;AACF;AAGO,MAAM,SAAS;IACpB,SAAS;AACX"}}]
}