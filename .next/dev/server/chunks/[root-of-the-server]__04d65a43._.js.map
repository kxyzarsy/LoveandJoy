{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 58, "column": 0}, "map": {"version":3,"sources":["file:///D:/MyBlog/LoveandJoy/src/app/api/upload/route.ts"],"sourcesContent":["import { NextResponse } from 'next/server';\r\nimport { writeFileSync, mkdirSync, existsSync } from 'fs';\r\nimport { join } from 'path';\r\n\r\n// 确保上传目录存在\r\nconst uploadDir = join(process.cwd(), 'public', 'uploads');\r\nif (!existsSync(uploadDir)) {\r\n  mkdirSync(uploadDir, { recursive: true });\r\n}\r\n\r\nexport async function POST(request: Request) {\r\n  try {\r\n    const formData = await request.formData();\r\n    const file = formData.get('file') as File;\r\n    \r\n    if (!file) {\r\n      return NextResponse.json({ error: '没有文件上传' }, { status: 400 });\r\n    }\r\n    \r\n    // 检查文件类型\r\n    const allowedTypes = ['image/jpeg', 'image/png', 'image/gif'];\r\n    if (!allowedTypes.includes(file.type)) {\r\n      return NextResponse.json({ error: '不支持的文件类型，请上传JPG、PNG或GIF格式的图片' }, { status: 400 });\r\n    }\r\n    \r\n    // 检查文件大小\r\n    const maxSize = 5 * 1024 * 1024; // 5MB\r\n    if (file.size > maxSize) {\r\n      return NextResponse.json({ error: '文件大小超过限制，请上传小于5MB的图片' }, { status: 400 });\r\n    }\r\n    \r\n    // 生成唯一文件名\r\n    const timestamp = Date.now();\r\n    const fileExtension = file.name.split('.').pop();\r\n    const filename = `${timestamp}-${Math.random().toString(36).substring(2, 10)}.${fileExtension}`;\r\n    const filePath = join(uploadDir, filename);\r\n    \r\n    // 读取文件内容并写入磁盘\r\n    const buffer = Buffer.from(await file.arrayBuffer());\r\n    writeFileSync(filePath, buffer);\r\n    \r\n    // 返回文件URL\r\n    const fileUrl = `/uploads/${filename}`;\r\n    return NextResponse.json({ url: fileUrl }, { status: 200 });\r\n  } catch (error) {\r\n    console.error('文件上传失败:', error);\r\n    return NextResponse.json({ error: '文件上传失败', details: (error as Error).message }, { status: 500 });\r\n  }\r\n}"],"names":[],"mappings":";;;;AAAA;AACA;AACA;;;;AAEA,WAAW;AACX,MAAM,YAAY,IAAA,yGAAI,EAAC,QAAQ,GAAG,IAAI,UAAU;AAChD,IAAI,CAAC,IAAA,2GAAU,EAAC,YAAY;IAC1B,IAAA,0GAAS,EAAC,WAAW;QAAE,WAAW;IAAK;AACzC;AAEO,eAAe,KAAK,OAAgB;IACzC,IAAI;QACF,MAAM,WAAW,MAAM,QAAQ,QAAQ;QACvC,MAAM,OAAO,SAAS,GAAG,CAAC;QAE1B,IAAI,CAAC,MAAM;YACT,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAS,GAAG;gBAAE,QAAQ;YAAI;QAC9D;QAEA,SAAS;QACT,MAAM,eAAe;YAAC;YAAc;YAAa;SAAY;QAC7D,IAAI,CAAC,aAAa,QAAQ,CAAC,KAAK,IAAI,GAAG;YACrC,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAA+B,GAAG;gBAAE,QAAQ;YAAI;QACpF;QAEA,SAAS;QACT,MAAM,UAAU,IAAI,OAAO,MAAM,MAAM;QACvC,IAAI,KAAK,IAAI,GAAG,SAAS;YACvB,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAuB,GAAG;gBAAE,QAAQ;YAAI;QAC5E;QAEA,UAAU;QACV,MAAM,YAAY,KAAK,GAAG;QAC1B,MAAM,gBAAgB,KAAK,IAAI,CAAC,KAAK,CAAC,KAAK,GAAG;QAC9C,MAAM,WAAW,GAAG,UAAU,CAAC,EAAE,KAAK,MAAM,GAAG,QAAQ,CAAC,IAAI,SAAS,CAAC,GAAG,IAAI,CAAC,EAAE,eAAe;QAC/F,MAAM,WAAW,IAAA,yGAAI,EAAC,WAAW;QAEjC,cAAc;QACd,MAAM,SAAS,OAAO,IAAI,CAAC,MAAM,KAAK,WAAW;QACjD,IAAA,8GAAa,EAAC,UAAU;QAExB,UAAU;QACV,MAAM,UAAU,CAAC,SAAS,EAAE,UAAU;QACtC,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,KAAK;QAAQ,GAAG;YAAE,QAAQ;QAAI;IAC3D,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,WAAW;QACzB,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;YAAU,SAAS,AAAC,MAAgB,OAAO;QAAC,GAAG;YAAE,QAAQ;QAAI;IACjG;AACF"}}]
}