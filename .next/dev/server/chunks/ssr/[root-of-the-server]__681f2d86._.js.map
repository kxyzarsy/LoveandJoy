{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///D:/MyBlog/LoveandJoy/src/app/admin-secret.ts"],"sourcesContent":["\r\n/**\r\n * 管理员秘钥管理系统\r\n * 用于管理管理员登录秘钥，实现高安全性的管理员认证\r\n */\r\n\r\n/**\r\n * 管理员秘钥管理系统\r\n * 用于管理管理员登录秘钥，实现高安全性的管理员认证\r\n * 注意：当前使用临时解决方案，后续将替换为数据库实现\r\n */\r\n\r\n/**\r\n * 生成随机秘钥\r\n * @param length 秘钥长度\r\n * @returns 随机秘钥\r\n */\r\nexport function generateSecretKey(length = 32): string {\r\n  const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@#$%^&*()_+-=[]{}|;:,.<>?';\r\n  let result = '';\r\n  for (let i = 0; i < length; i++) {\r\n    result += chars.charAt(Math.floor(Math.random() * chars.length));\r\n  }\r\n  return result;\r\n}\r\n\r\n/**\r\n * 获取当前有效秘钥\r\n * @returns 有效秘钥或null\r\n */\r\nexport async function getCurrentSecret(): Promise<string | null> {\r\n  try {\r\n    // 这里使用内存存储作为临时解决方案，后续将替换为数据库查询\r\n    const secret = process.env.ADMIN_SECRET || 'default-secret-key';\r\n    return secret;\r\n  } catch (error) {\r\n    console.error('获取当前秘钥失败:', error);\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * 验证秘钥是否有效\r\n * @param secretKey 待验证的秘钥\r\n * @returns 验证结果\r\n */\r\nexport async function validateSecret(secretKey: string): Promise<boolean> {\r\n  try {\r\n    const currentSecret = await getCurrentSecret();\r\n    return secretKey === currentSecret;\r\n  } catch (error) {\r\n    console.error('验证秘钥失败:', error);\r\n    return false;\r\n  }\r\n}\r\n\r\n/**\r\n * 更新管理员秘钥\r\n * @param updatedBy 更新人ID\r\n * @returns 更新后的秘钥\r\n */\r\nexport async function updateAdminSecret(updatedBy: number | null): Promise<string> {\r\n  try {\r\n    const newSecret = generateSecretKey();\r\n    \r\n    // 这里使用环境变量作为临时解决方案，后续将替换为数据库更新\r\n\r\n    \r\n    // 发送秘钥更新通知邮件\r\n    await sendSecretUpdateEmail(newSecret);\r\n    \r\n    return newSecret;\r\n  } catch (error) {\r\n    console.error('更新管理员秘钥失败:', error);\r\n    throw error;\r\n  }\r\n}\r\n\r\n/**\r\n * 发送秘钥更新邮件\r\n * @param newSecret 新秘钥\r\n */\r\nexport async function sendSecretUpdateEmail(newSecret: string): Promise<void> {\r\n  try {\r\n    const emailData = {\r\n      to: 'kxyatxy116@163.com',\r\n      subject: '【重要】管理员秘钥已更新',\r\n      html: `\r\n        <h2>管理员秘钥更新通知</h2>\r\n        <p>您的管理员秘钥已成功更新，新秘钥如下：</p>\r\n        <p style=\"font-size: 18px; font-weight: bold; color: #333; background: #f0f0f0; padding: 10px; border-radius: 5px;\">${newSecret}</p>\r\n        <p>请妥善保管此秘钥，切勿泄露给他人。</p>\r\n        <p>秘钥有效期：7天</p>\r\n        <p>系统将在秘钥过期前24小时再次提醒您更新。</p>\r\n        <hr>\r\n        <p>此邮件由系统自动发送，请勿回复。</p>\r\n      `\r\n    };\r\n    \r\n    // 调用服务器端API发送邮件\r\n    const response = await fetch('/api/send-email', {\r\n      method: 'POST',\r\n      headers: {\r\n        'Content-Type': 'application/json'\r\n      },\r\n      body: JSON.stringify(emailData)\r\n    });\r\n    \r\n    if (response.ok) {\r\n\r\n    } else {\r\n      console.error('发送秘钥更新邮件失败:', await response.json());\r\n    }\r\n  } catch (error) {\r\n    console.error('发送秘钥更新邮件失败:', error);\r\n  }\r\n}\r\n\r\n/**\r\n * 记录登录日志\r\n * @param data 登录日志数据\r\n */\r\nexport async function logLoginAttempt(data: {\r\n  userId?: number;\r\n  username: string;\r\n  ipAddress: string;\r\n  userAgent: string;\r\n  isSuccess: boolean;\r\n  errorMessage?: string;\r\n}): Promise<void> {\r\n  try {\r\n    // 这里使用控制台日志作为临时解决方案，后续将替换为数据库插入\r\n\r\n  } catch (error) {\r\n    console.error('记录登录日志失败:', error);\r\n  }\r\n}\r\n\r\n/**\r\n * 检查秘钥是否需要更新\r\n * @returns 是否需要更新\r\n */\r\nexport async function checkSecretUpdateNeeded(): Promise<boolean> {\r\n  try {\r\n    // 这里使用固定逻辑作为临时解决方案，后续将替换为数据库查询\r\n    // 实际实现中应检查秘钥创建时间，判断是否需要更新\r\n    return false;\r\n  } catch (error) {\r\n    console.error('检查秘钥更新需求失败:', error);\r\n    return false;\r\n  }\r\n}\r\n\r\n/**\r\n * 初始化管理员秘钥\r\n */\r\nexport async function initializeAdminSecret(): Promise<void> {\r\n  try {\r\n    // 检查是否已有秘钥\r\n    const currentSecret = await getCurrentSecret();\r\n    if (!currentSecret || currentSecret === 'default-secret-key') {\r\n      // 生成新秘钥\r\n      const newSecret = generateSecretKey();\r\n\r\n      await sendSecretUpdateEmail(newSecret);\r\n    }\r\n  } catch (error) {\r\n    console.error('初始化管理员秘钥失败:', error);\r\n  }\r\n}\r\n"],"names":[],"mappings":"AACA;;;CAGC,GAED;;;;CAIC,GAED;;;;CAIC;;;;;;;;;;;;;;;;;;AACM,SAAS,kBAAkB,SAAS,EAAE;IAC3C,MAAM,QAAQ;IACd,IAAI,SAAS;IACb,IAAK,IAAI,IAAI,GAAG,IAAI,QAAQ,IAAK;QAC/B,UAAU,MAAM,MAAM,CAAC,KAAK,KAAK,CAAC,KAAK,MAAM,KAAK,MAAM,MAAM;IAChE;IACA,OAAO;AACT;AAMO,eAAe;IACpB,IAAI;QACF,+BAA+B;QAC/B,MAAM,SAAS,QAAQ,GAAG,CAAC,YAAY,IAAI;QAC3C,OAAO;IACT,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,aAAa;QAC3B,OAAO;IACT;AACF;AAOO,eAAe,eAAe,SAAiB;IACpD,IAAI;QACF,MAAM,gBAAgB,MAAM;QAC5B,OAAO,cAAc;IACvB,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,WAAW;QACzB,OAAO;IACT;AACF;AAOO,eAAe,kBAAkB,SAAwB;IAC9D,IAAI;QACF,MAAM,YAAY;QAElB,+BAA+B;QAG/B,aAAa;QACb,MAAM,sBAAsB;QAE5B,OAAO;IACT,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,cAAc;QAC5B,MAAM;IACR;AACF;AAMO,eAAe,sBAAsB,SAAiB;IAC3D,IAAI;QACF,MAAM,YAAY;YAChB,IAAI;YACJ,SAAS;YACT,MAAM,CAAC;;;4HAG+G,EAAE,UAAU;;;;;;MAMlI,CAAC;QACH;QAEA,gBAAgB;QAChB,MAAM,WAAW,MAAM,MAAM,mBAAmB;YAC9C,QAAQ;YACR,SAAS;gBACP,gBAAgB;YAClB;YACA,MAAM,KAAK,SAAS,CAAC;QACvB;QAEA,IAAI,SAAS,EAAE,EAAE,CAEjB,OAAO;YACL,QAAQ,KAAK,CAAC,eAAe,MAAM,SAAS,IAAI;QAClD;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,eAAe;IAC/B;AACF;AAMO,eAAe,gBAAgB,IAOrC;IACC,IAAI;IACF,gCAAgC;IAElC,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,aAAa;IAC7B;AACF;AAMO,eAAe;IACpB,IAAI;QACF,+BAA+B;QAC/B,0BAA0B;QAC1B,OAAO;IACT,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,eAAe;QAC7B,OAAO;IACT;AACF;AAKO,eAAe;IACpB,IAAI;QACF,WAAW;QACX,MAAM,gBAAgB,MAAM;QAC5B,IAAI,CAAC,iBAAiB,kBAAkB,sBAAsB;YAC5D,QAAQ;YACR,MAAM,YAAY;YAElB,MAAM,sBAAsB;QAC9B;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,eAAe;IAC/B;AACF"}},
    {"offset": {"line": 161, "column": 0}, "map": {"version":3,"sources":["file:///D:/MyBlog/LoveandJoy/src/utils/admin-state-manager.ts"],"sourcesContent":["// 管理员页面专用状态管理工具\r\n// 使用正确的jsonwebtoken导入方式\r\nimport jwt from 'jsonwebtoken';\r\n\r\n// 键名前缀，避免与用户页面状态冲突\r\nconst ADMIN_STATE_PREFIX = 'admin_';\r\n\r\n// 管理员状态类型\r\nexport interface AdminState {\r\n  isLoggedIn: boolean;\r\n  user: {\r\n    id: number;\r\n    name: string;\r\n    username: string;\r\n    email: string;\r\n    avatar: string;\r\n    bio: string;\r\n    role: 'admin' | 'user';\r\n    createdAt: string;\r\n  };\r\n  token: string;\r\n  [key: string]: any;\r\n}\r\n\r\n// 生成JWT令牌\r\nexport const generateAdminToken = (userId: number, email: string, role: string): string => {\r\n  // 使用环境变量或安全的密钥\r\n  const secretKey = process.env.JWT_SECRET || 'your-secret-key';\r\n  const expiresIn = '2h'; // 令牌过期时间\r\n  \r\n  return jwt.sign(\r\n    { userId, email, role },\r\n    secretKey,\r\n    { expiresIn }\r\n  );\r\n};\r\n\r\n// 获取管理员状态\r\nexport const getAdminState = <T = any>(key: string): T | null => {\r\n  try {\r\n    const fullKey = `${ADMIN_STATE_PREFIX}${key}`;\r\n    const value = localStorage.getItem(fullKey);\r\n    if (!value) return null;\r\n    \r\n    // 尝试解析为 JSON，如果失败则直接返回字符串\r\n    try {\r\n      return JSON.parse(value) as T;\r\n    } catch (parseError) {\r\n      // 如果解析失败，直接返回字符串值，不进行类型转换\r\n      return value as unknown as T;\r\n    }\r\n  } catch (error) {\r\n    console.error('获取管理员状态失败:', error);\r\n    return null;\r\n  }\r\n};\r\n\r\n// 设置管理员状态\r\nexport const setAdminState = (key: string, value: any): void => {\r\n  try {\r\n    const fullKey = `${ADMIN_STATE_PREFIX}${key}`;\r\n    localStorage.setItem(fullKey, JSON.stringify(value));\r\n    // 触发自定义事件，通知其他组件状态已更新\r\n    window.dispatchEvent(new Event('adminStateChanged'));\r\n  } catch (error) {\r\n    console.error('设置管理员状态失败:', error);\r\n  }\r\n};\r\n\r\n// 删除管理员状态\r\nexport const removeAdminState = (key: string): void => {\r\n  try {\r\n    const fullKey = `${ADMIN_STATE_PREFIX}${key}`;\r\n    localStorage.removeItem(fullKey);\r\n    // 触发自定义事件，通知其他组件状态已更新\r\n    window.dispatchEvent(new Event('adminStateChanged'));\r\n  } catch (error) {\r\n    console.error('删除管理员状态失败:', error);\r\n  }\r\n};\r\n\r\n// 清除所有管理员状态\r\nexport const clearAllAdminState = (): void => {\r\n  try {\r\n    // 遍历所有localStorage项，删除带有管理员前缀的项\r\n    for (let i = 0; i < localStorage.length; i++) {\r\n      const key = localStorage.key(i);\r\n      if (key && key.startsWith(ADMIN_STATE_PREFIX)) {\r\n        localStorage.removeItem(key);\r\n      }\r\n    }\r\n    // 触发自定义事件，通知其他组件状态已更新\r\n    window.dispatchEvent(new Event('adminStateChanged'));\r\n  } catch (error) {\r\n    console.error('清除所有管理员状态失败:', error);\r\n  }\r\n};\r\n\r\n// 监听管理员状态变化\r\nexport const listenToAdminStateChanges = (callback: () => void): (() => void) => {\r\n  window.addEventListener('adminStateChanged', callback);\r\n  return () => {\r\n    window.removeEventListener('adminStateChanged', callback);\r\n  };\r\n};\r\n\r\n// 获取管理员请求头，包含Authorization令牌\r\nexport const getAdminHeaders = (): HeadersInit => {\r\n  let token = getAdminState<string>('token');\r\n  \r\n  // 如果令牌是带引号的字符串，去除引号\r\n  if (token && (token.startsWith('\"') && token.endsWith('\"'))) {\r\n    token = token.slice(1, -1);\r\n  }\r\n  \r\n  return {\r\n    'Content-Type': 'application/json',\r\n    ...(token ? { Authorization: `Bearer ${token}` } : {})\r\n  };\r\n};\r\n\r\n// 管理员登录状态管理\r\nexport const adminAuth = {\r\n  // 检查管理员是否已登录\r\n  isAuthenticated: (): boolean => {\r\n    return getAdminState<boolean>('isLoggedIn') === true;\r\n  },\r\n  \r\n  // 获取当前登录的管理员用户\r\n  getCurrentUser: (): AdminState['user'] | null => {\r\n    return getAdminState<AdminState['user']>('user');\r\n  },\r\n  \r\n  // 管理员登录\r\n  login: (user: AdminState['user']): void => {\r\n    // 生成JWT令牌\r\n    const token = generateAdminToken(user.id, user.email, user.role);\r\n    \r\n    console.log('Generated admin token:', token);\r\n    \r\n    setAdminState('isLoggedIn', true);\r\n    setAdminState('user', user);\r\n    setAdminState('token', token);\r\n    \r\n    // 验证令牌是否正确存储\r\n    const storedToken = getAdminState<string>('token');\r\n    console.log('Stored admin token:', storedToken);\r\n  },\r\n  \r\n  // 管理员登出\r\n  logout: (): void => {\r\n    clearAllAdminState();\r\n  }\r\n};\r\n"],"names":[],"mappings":"AAAA,gBAAgB;AAChB,wBAAwB;;;;;;;;;;;;;;;;;;;AACxB;;AAEA,mBAAmB;AACnB,MAAM,qBAAqB;AAoBpB,MAAM,qBAAqB,CAAC,QAAgB,OAAe;IAChE,eAAe;IACf,MAAM,YAAY,QAAQ,GAAG,CAAC,UAAU,IAAI;IAC5C,MAAM,YAAY,MAAM,SAAS;IAEjC,OAAO,gJAAG,CAAC,IAAI,CACb;QAAE;QAAQ;QAAO;IAAK,GACtB,WACA;QAAE;IAAU;AAEhB;AAGO,MAAM,gBAAgB,CAAU;IACrC,IAAI;QACF,MAAM,UAAU,GAAG,qBAAqB,KAAK;QAC7C,MAAM,QAAQ,aAAa,OAAO,CAAC;QACnC,IAAI,CAAC,OAAO,OAAO;QAEnB,0BAA0B;QAC1B,IAAI;YACF,OAAO,KAAK,KAAK,CAAC;QACpB,EAAE,OAAO,YAAY;YACnB,0BAA0B;YAC1B,OAAO;QACT;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,cAAc;QAC5B,OAAO;IACT;AACF;AAGO,MAAM,gBAAgB,CAAC,KAAa;IACzC,IAAI;QACF,MAAM,UAAU,GAAG,qBAAqB,KAAK;QAC7C,aAAa,OAAO,CAAC,SAAS,KAAK,SAAS,CAAC;QAC7C,sBAAsB;QACtB,OAAO,aAAa,CAAC,IAAI,MAAM;IACjC,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,cAAc;IAC9B;AACF;AAGO,MAAM,mBAAmB,CAAC;IAC/B,IAAI;QACF,MAAM,UAAU,GAAG,qBAAqB,KAAK;QAC7C,aAAa,UAAU,CAAC;QACxB,sBAAsB;QACtB,OAAO,aAAa,CAAC,IAAI,MAAM;IACjC,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,cAAc;IAC9B;AACF;AAGO,MAAM,qBAAqB;IAChC,IAAI;QACF,gCAAgC;QAChC,IAAK,IAAI,IAAI,GAAG,IAAI,aAAa,MAAM,EAAE,IAAK;YAC5C,MAAM,MAAM,aAAa,GAAG,CAAC;YAC7B,IAAI,OAAO,IAAI,UAAU,CAAC,qBAAqB;gBAC7C,aAAa,UAAU,CAAC;YAC1B;QACF;QACA,sBAAsB;QACtB,OAAO,aAAa,CAAC,IAAI,MAAM;IACjC,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,gBAAgB;IAChC;AACF;AAGO,MAAM,4BAA4B,CAAC;IACxC,OAAO,gBAAgB,CAAC,qBAAqB;IAC7C,OAAO;QACL,OAAO,mBAAmB,CAAC,qBAAqB;IAClD;AACF;AAGO,MAAM,kBAAkB;IAC7B,IAAI,QAAQ,cAAsB;IAElC,oBAAoB;IACpB,IAAI,SAAU,MAAM,UAAU,CAAC,QAAQ,MAAM,QAAQ,CAAC,MAAO;QAC3D,QAAQ,MAAM,KAAK,CAAC,GAAG,CAAC;IAC1B;IAEA,OAAO;QACL,gBAAgB;QAChB,GAAI,QAAQ;YAAE,eAAe,CAAC,OAAO,EAAE,OAAO;QAAC,IAAI,CAAC,CAAC;IACvD;AACF;AAGO,MAAM,YAAY;IACvB,aAAa;IACb,iBAAiB;QACf,OAAO,cAAuB,kBAAkB;IAClD;IAEA,eAAe;IACf,gBAAgB;QACd,OAAO,cAAkC;IAC3C;IAEA,QAAQ;IACR,OAAO,CAAC;QACN,UAAU;QACV,MAAM,QAAQ,mBAAmB,KAAK,EAAE,EAAE,KAAK,KAAK,EAAE,KAAK,IAAI;QAE/D,QAAQ,GAAG,CAAC,0BAA0B;QAEtC,cAAc,cAAc;QAC5B,cAAc,QAAQ;QACtB,cAAc,SAAS;QAEvB,aAAa;QACb,MAAM,cAAc,cAAsB;QAC1C,QAAQ,GAAG,CAAC,uBAAuB;IACrC;IAEA,QAAQ;IACR,QAAQ;QACN;IACF;AACF"}},
    {"offset": {"line": 298, "column": 0}, "map": {"version":3,"sources":["file:///D:/MyBlog/LoveandJoy/src/app/admin/secret-login/page.tsx"],"sourcesContent":["'use client'\r\n\r\nimport { useState, useEffect } from 'react'\r\nimport { useRouter } from 'next/navigation'\r\nimport { validateSecret, logLoginAttempt } from '../../admin-secret'\r\nimport { adminAuth } from '../../../utils/admin-state-manager'\r\n\r\n/**\r\n * 隐藏式管理员登录页面\r\n * 只有知道正确URL的用户才能访问\r\n */\r\nexport default function SecretAdminLoginPage() {\r\n  const router = useRouter()\r\n  const [username, setUsername] = useState('')\r\n  const [password, setPassword] = useState('')\r\n  const [secretKey, setSecretKey] = useState('')\r\n  const [errors, setErrors] = useState<{ message?: string }>({})\r\n  const [isLoading, setIsLoading] = useState(false)\r\n  const [showSecretField, setShowSecretField] = useState(false)\r\n\r\n  // 隐藏式入口验证：只有输入正确的初始密码才能显示秘钥字段\r\n  const handleInitialSubmit = (e: React.FormEvent<HTMLFormElement>) => {\r\n    e.preventDefault()\r\n    const initialPassword = (e.currentTarget as any).initialPassword.value\r\n    \r\n    // 初始密码验证（简单的隐藏入口机制）\r\n    if (initialPassword === 'admin-portal') {\r\n      setShowSecretField(true)\r\n    } else {\r\n      // 记录失败尝试\r\n      logLoginAttempt({\r\n        username: 'unknown',\r\n        ipAddress: typeof window !== 'undefined' ? window.location.hostname : 'unknown',\r\n        userAgent: typeof window !== 'undefined' ? navigator.userAgent : 'unknown',\r\n        isSuccess: false,\r\n        errorMessage: '初始密码错误'\r\n      })\r\n      setErrors({ message: '访问被拒绝' })\r\n    }\r\n  }\r\n\r\n  const handleLogin = async (e: React.FormEvent<HTMLFormElement>) => {\r\n    e.preventDefault()\r\n    setIsLoading(true)\r\n    setErrors({})\r\n\r\n    try {\r\n      // 记录登录尝试\r\n      await logLoginAttempt({\r\n        username,\r\n        ipAddress: typeof window !== 'undefined' ? window.location.hostname : 'unknown',\r\n        userAgent: typeof window !== 'undefined' ? navigator.userAgent : 'unknown',\r\n        isSuccess: false\r\n      })\r\n\r\n      // 验证管理员秘钥\r\n      const isSecretValid = await validateSecret(secretKey)\r\n      if (!isSecretValid) {\r\n        await logLoginAttempt({\r\n          username,\r\n          ipAddress: typeof window !== 'undefined' ? window.location.hostname : 'unknown',\r\n          userAgent: typeof window !== 'undefined' ? navigator.userAgent : 'unknown',\r\n          isSuccess: false,\r\n          errorMessage: '管理员秘钥错误'\r\n        })\r\n        setErrors({ message: '管理员秘钥错误' })\r\n        return\r\n      }\r\n\r\n      // 通过API进行登录验证\r\n      const loginResponse = await fetch('/api/auth/login', {\r\n        method: 'POST',\r\n        headers: {\r\n          'Content-Type': 'application/json'\r\n        },\r\n        body: JSON.stringify({\r\n          email: username === 'admin' ? 'admin@admin' : username,\r\n          password\r\n        })\r\n      })\r\n\r\n      const loginData = await loginResponse.json()\r\n      \r\n      if (!loginResponse.ok || !loginData.success) {\r\n        await logLoginAttempt({\r\n          username,\r\n          ipAddress: typeof window !== 'undefined' ? window.location.hostname : 'unknown',\r\n          userAgent: typeof window !== 'undefined' ? navigator.userAgent : 'unknown',\r\n          isSuccess: false,\r\n          errorMessage: loginData.message || '用户名或密码错误'\r\n        })\r\n        setErrors({ message: loginData.message || '用户名或密码错误' })\r\n        return\r\n      }\r\n\r\n      // 登录成功，记录登录日志\r\n      await logLoginAttempt({\r\n        username,\r\n        ipAddress: typeof window !== 'undefined' ? window.location.hostname : 'unknown',\r\n        userAgent: typeof window !== 'undefined' ? navigator.userAgent : 'unknown',\r\n        isSuccess: true\r\n      })\r\n\r\n      // 设置管理员用户数据\r\n      const userData = {\r\n        id: loginData.data.userInfo.id,\r\n        name: loginData.data.userInfo.name,\r\n        username: loginData.data.userInfo.usernameId,\r\n        email: loginData.data.userInfo.email,\r\n        avatar: loginData.data.userInfo.avatar || 'https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=100&h=100&fit=crop',\r\n        bio: '系统管理员',\r\n        role: loginData.data.userInfo.role as 'admin' | 'user',\r\n        createdAt: new Date().toISOString()\r\n      }\r\n      \r\n      // 使用管理员专用状态管理工具保存登录状态\r\n      adminAuth.login(userData)\r\n\r\n      // 跳转到管理员后台首页\r\n      router.push('/admin')\r\n    } catch (error) {\r\n      console.error('登录失败:', error)\r\n      setErrors({ message: '登录失败，请重试' })\r\n      \r\n      // 记录失败日志\r\n      await logLoginAttempt({\r\n        username,\r\n        ipAddress: typeof window !== 'undefined' ? window.location.hostname : 'unknown',\r\n        userAgent: typeof window !== 'undefined' ? navigator.userAgent : 'unknown',\r\n        isSuccess: false,\r\n        errorMessage: '系统错误'\r\n      })\r\n    } finally {\r\n      setIsLoading(false)\r\n    }\r\n  }\r\n\r\n  return (\r\n    <div className=\"min-h-[calc(100vh-200px)] flex items-center justify-center py-12 px-4 sm:px-6 lg:px-8\">\r\n      <div className=\"max-w-md w-full space-y-8\">\r\n        <div>\r\n          <h2 className=\"mt-6 text-center text-3xl font-extrabold text-gray-900\">\r\n            {showSecretField ? '管理员登录' : '访问验证'}\r\n          </h2>\r\n          <p className=\"mt-2 text-center text-sm text-gray-600\">\r\n            {showSecretField ? '请输入管理员账号、密码和秘钥' : '请输入访问密码'}\r\n          </p>\r\n        </div>\r\n\r\n        {errors.message && (\r\n          <div className=\"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-md\">\r\n            {errors.message}\r\n          </div>\r\n        )}\r\n\r\n        {!showSecretField ? (\r\n          // 初始访问验证表单\r\n          <form className=\"mt-8 space-y-6\" onSubmit={handleInitialSubmit}>\r\n            <div>\r\n              <label htmlFor=\"initialPassword\" className=\"sr-only\">\r\n                访问密码\r\n              </label>\r\n              <input\r\n                id=\"initialPassword\"\r\n                name=\"initialPassword\"\r\n                type=\"password\"\r\n                required\r\n                className=\"appearance-none relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-md focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm\"\r\n                placeholder=\"请输入访问密码\"\r\n              />\r\n            </div>\r\n\r\n            <div>\r\n              <button\r\n                type=\"submit\"\r\n                className=\"group relative w-full flex justify-center py-2 px-4 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors\"\r\n              >\r\n                验证访问\r\n              </button>\r\n            </div>\r\n          </form>\r\n        ) : (\r\n          // 完整管理员登录表单\r\n          <form className=\"mt-8 space-y-6\" onSubmit={handleLogin}>\r\n            <div className=\"rounded-md -space-y-px\">\r\n              <div>\r\n                <label htmlFor=\"username\" className=\"sr-only\">\r\n                  用户名\r\n                </label>\r\n                <input\r\n                  id=\"username\"\r\n                  name=\"username\"\r\n                  type=\"text\"\r\n                  autoComplete=\"username\"\r\n                  required\r\n                  className=\"appearance-none rounded-none relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-t-md focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm\"\r\n                  placeholder=\"用户名\"\r\n                  value={username}\r\n                  onChange={(e) => setUsername(e.target.value)}\r\n                />\r\n              </div>\r\n              <div>\r\n                <label htmlFor=\"password\" className=\"sr-only\">\r\n                  密码\r\n                </label>\r\n                <input\r\n                  id=\"password\"\r\n                  name=\"password\"\r\n                  type=\"password\"\r\n                  autoComplete=\"current-password\"\r\n                  required\r\n                  className=\"appearance-none rounded-none relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm\"\r\n                  placeholder=\"密码\"\r\n                  value={password}\r\n                  onChange={(e) => setPassword(e.target.value)}\r\n                />\r\n              </div>\r\n              <div>\r\n                <label htmlFor=\"secretKey\" className=\"sr-only\">\r\n                  管理员秘钥\r\n                </label>\r\n                <input\r\n                  id=\"secretKey\"\r\n                  name=\"secretKey\"\r\n                  type=\"password\"\r\n                  required\r\n                  className=\"appearance-none rounded-b-md relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm\"\r\n                  placeholder=\"管理员秘钥\"\r\n                  value={secretKey}\r\n                  onChange={(e) => setSecretKey(e.target.value)}\r\n                />\r\n              </div>\r\n            </div>\r\n\r\n            <div>\r\n              <button\r\n                type=\"submit\"\r\n                disabled={isLoading}\r\n                className=\"group relative w-full flex justify-center py-2 px-4 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors disabled:opacity-70 disabled:cursor-not-allowed\"\r\n              >\r\n                {isLoading ? '登录中...' : '登录'}\r\n              </button>\r\n            </div>\r\n          </form>\r\n        )}\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n"],"names":[],"mappings":"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"}}]
}