module.exports=[55843,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(50944),e=a.i(25118);let f=({setMessage:a})=>{let[d,e]=(0,c.useState)(""),[f,g]=(0,c.useState)(""),[h,i]=(0,c.useState)(""),[j,k]=(0,c.useState)(!1),[l,m]=(0,c.useState)(!1),n=a=>a.length<16?"密钥长度至少为16个字符":/[A-Z]/.test(a)?/[a-z]/.test(a)?/[0-9]/.test(a)?/[^A-Za-z0-9]/.test(a)?"":"密钥必须包含至少一个特殊字符":"密钥必须包含至少一个数字":"密钥必须包含至少一个小写字母":"密钥必须包含至少一个大写字母",o=async b=>{if(b.preventDefault(),!l)return void m(!0);let c=n(f);if(c)return void a({type:"error",text:c});if(f!==h)return void a({type:"error",text:"新密钥与确认密钥不匹配"});k(!0);try{let b=await fetch("/api/admin/credentials/secret-key",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({currentKey:d,newKey:f})}),c=await b.json();b.ok?(a({type:"success",text:"管理员密钥更新成功"}),e(""),g(""),i("")):a({type:"error",text:c.error||"更新失败，请重试"})}catch(b){a({type:"error",text:"服务器错误，请稍后重试"})}finally{k(!1),m(!1)}};return(0,b.jsxs)("form",{onSubmit:o,children:[(0,b.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"修改管理员密钥"}),l&&(0,b.jsxs)("div",{className:"bg-yellow-100 border border-yellow-400 text-yellow-700 px-4 py-3 rounded mb-4",children:[(0,b.jsx)("p",{className:"font-bold",children:"确认操作"}),(0,b.jsx)("p",{children:"您确定要修改管理员密钥吗？此操作将影响所有管理员的访问权限。"}),(0,b.jsxs)("div",{className:"mt-2 flex space-x-2",children:[(0,b.jsx)("button",{type:"button",className:"px-4 py-2 bg-gray-200 text-gray-800 rounded hover:bg-gray-300",onClick:()=>m(!1),children:"取消"}),(0,b.jsx)("button",{type:"submit",className:"px-4 py-2 bg-red-500 text-white rounded hover:bg-red-600",children:"确认修改"})]})]}),!l&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("div",{className:"mb-4",children:[(0,b.jsx)("label",{htmlFor:"currentKey",className:"block text-sm font-medium text-gray-700 mb-1",children:"当前管理员密钥"}),(0,b.jsx)("input",{type:"password",id:"currentKey",value:d,onChange:a=>e(a.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),(0,b.jsxs)("div",{className:"mb-4",children:[(0,b.jsx)("label",{htmlFor:"newKey",className:"block text-sm font-medium text-gray-700 mb-1",children:"新管理员密钥"}),(0,b.jsx)("input",{type:"password",id:"newKey",value:f,onChange:a=>g(a.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0}),f&&(0,b.jsx)("p",{className:"mt-1 text-xs text-gray-500",children:n(f)||"密钥强度：强"})]}),(0,b.jsxs)("div",{className:"mb-6",children:[(0,b.jsx)("label",{htmlFor:"confirmKey",className:"block text-sm font-medium text-gray-700 mb-1",children:"确认新管理员密钥"}),(0,b.jsx)("input",{type:"password",id:"confirmKey",value:h,onChange:a=>i(a.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),(0,b.jsx)("div",{className:"flex justify-end",children:(0,b.jsx)("button",{type:"submit",className:"px-6 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2",disabled:j,children:j?"提交中...":"修改密钥"})})]})]})},g=({setMessage:a})=>{let[d,e]=(0,c.useState)(""),[f,g]=(0,c.useState)(""),[h,i]=(0,c.useState)(""),[j,k]=(0,c.useState)(!1),[l,m]=(0,c.useState)(!1),n=a=>a.length<8?"密码长度至少为8个字符":/[A-Z]/.test(a)?/[a-z]/.test(a)?/[0-9]/.test(a)?"":"密码必须包含至少一个数字":"密码必须包含至少一个小写字母":"密码必须包含至少一个大写字母",o=async b=>{if(b.preventDefault(),!l)return void m(!0);let c=n(f);if(c)return void a({type:"error",text:c});if(f!==h)return void a({type:"error",text:"新密码与确认密码不匹配"});k(!0);try{let b=await fetch("/api/admin/credentials/access-password",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({currentPassword:d,newPassword:f})}),c=await b.json();b.ok?(a({type:"success",text:"初始访问密码更新成功"}),e(""),g(""),i("")):a({type:"error",text:c.error||"更新失败，请重试"})}catch(b){a({type:"error",text:"服务器错误，请稍后重试"})}finally{k(!1),m(!1)}};return(0,b.jsxs)("form",{onSubmit:o,children:[(0,b.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"修改初始访问密码"}),l&&(0,b.jsxs)("div",{className:"bg-yellow-100 border border-yellow-400 text-yellow-700 px-4 py-3 rounded mb-4",children:[(0,b.jsx)("p",{className:"font-bold",children:"确认操作"}),(0,b.jsx)("p",{children:"您确定要修改初始访问密码吗？此操作将影响管理员登录入口的访问权限。"}),(0,b.jsxs)("div",{className:"mt-2 flex space-x-2",children:[(0,b.jsx)("button",{type:"button",className:"px-4 py-2 bg-gray-200 text-gray-800 rounded hover:bg-gray-300",onClick:()=>m(!1),children:"取消"}),(0,b.jsx)("button",{type:"submit",className:"px-4 py-2 bg-red-500 text-white rounded hover:bg-red-600",children:"确认修改"})]})]}),!l&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("div",{className:"mb-4",children:[(0,b.jsx)("label",{htmlFor:"currentPassword",className:"block text-sm font-medium text-gray-700 mb-1",children:"当前初始访问密码"}),(0,b.jsx)("input",{type:"password",id:"currentPassword",value:d,onChange:a=>e(a.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),(0,b.jsxs)("div",{className:"mb-4",children:[(0,b.jsx)("label",{htmlFor:"newPassword",className:"block text-sm font-medium text-gray-700 mb-1",children:"新初始访问密码"}),(0,b.jsx)("input",{type:"password",id:"newPassword",value:f,onChange:a=>g(a.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0}),f&&(0,b.jsx)("p",{className:"mt-1 text-xs text-gray-500",children:n(f)||"密码强度：强"})]}),(0,b.jsxs)("div",{className:"mb-6",children:[(0,b.jsx)("label",{htmlFor:"confirmPassword",className:"block text-sm font-medium text-gray-700 mb-1",children:"确认新初始访问密码"}),(0,b.jsx)("input",{type:"password",id:"confirmPassword",value:h,onChange:a=>i(a.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),(0,b.jsx)("div",{className:"flex justify-end",children:(0,b.jsx)("button",{type:"submit",className:"px-6 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2",disabled:j,children:j?"提交中...":"修改密码"})})]})]})};a.s(["default",0,()=>{let a=(0,d.useRouter)();(0,c.useEffect)(()=>{let b=()=>{let b=e.adminAuth.isAuthenticated(),c=e.adminAuth.getCurrentUser();if(!b||!c||"admin"!==c.role)return void a.push("/admin/secret-login")};return b(),(0,e.listenToAdminStateChanges)(b)},[a]);let[h,i]=(0,c.useState)("secret-key"),[j,k]=(0,c.useState)(null),l=a=>{i(a),k(null)};return(0,b.jsxs)("div",{className:"container mx-auto px-4 py-8",children:[(0,b.jsx)("h1",{className:"text-2xl font-bold mb-6",children:"凭证管理"}),j&&(0,b.jsx)("div",{className:`mb-4 p-3 rounded ${"success"===j.type?"bg-green-100 text-green-700":"bg-red-100 text-red-700"}`,children:j.text}),(0,b.jsx)("div",{className:"border-b border-gray-200 mb-6",children:(0,b.jsxs)("nav",{className:"flex space-x-8",children:[(0,b.jsx)("button",{className:`py-3 px-1 border-b-2 font-medium text-sm ${"secret-key"===h?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,onClick:()=>l("secret-key"),children:"修改管理员密钥"}),(0,b.jsx)("button",{className:`py-3 px-1 border-b-2 font-medium text-sm ${"access-password"===h?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,onClick:()=>l("access-password"),children:"修改初始访问密码"})]})}),(0,b.jsxs)("div",{className:"bg-white shadow-md rounded-lg p-6",children:["secret-key"===h&&(0,b.jsx)(f,{setMessage:k}),"access-password"===h&&(0,b.jsx)(g,{setMessage:k})]})]})}])}];

//# sourceMappingURL=src_app_admin_credentials_page_tsx_6dc0268c._.js.map