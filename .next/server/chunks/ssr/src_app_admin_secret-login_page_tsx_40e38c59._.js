module.exports=[69899,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(50944);async function e(){try{return process.env.ADMIN_SECRET||"default-secret-key"}catch(a){return console.error("获取当前秘钥失败:",a),null}}async function f(a){try{let b=await e();return a===b}catch(a){return console.error("验证秘钥失败:",a),!1}}async function g(a){}var h=a.i(25118);function i(){let a=(0,d.useRouter)(),[e,i]=(0,c.useState)(""),[j,k]=(0,c.useState)(""),[l,m]=(0,c.useState)(""),[n,o]=(0,c.useState)({}),[p,q]=(0,c.useState)(!1),[r,s]=(0,c.useState)(!1),t=async b=>{b.preventDefault(),q(!0),o({});try{if(await g({username:e,ipAddress:"unknown",userAgent:"unknown",isSuccess:!1}),!await f(l)){await g({username:e,ipAddress:"unknown",userAgent:"unknown",isSuccess:!1,errorMessage:"管理员秘钥错误"}),o({message:"管理员秘钥错误"});return}let b=/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e),c={};if(b)c={email:e,password:j};else try{let a=await fetch(`/api/users?usernameId=${e}`),b=await a.json();if(b.length>0)c={email:b[0].email,password:j};else{await g({username:e,ipAddress:"unknown",userAgent:"unknown",isSuccess:!1,errorMessage:"用户名不存在"}),o({message:"用户名不存在"});return}}catch(a){console.error("查询用户邮箱失败:",a),o({message:"登录失败，请重试"});return}let d=await fetch("/api/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(c)}),i=await d.json();if(!d.ok||!i.success){await g({username:e,ipAddress:"unknown",userAgent:"unknown",isSuccess:!1,errorMessage:i.message||"用户名或密码错误"}),o({message:i.message||"用户名或密码错误"});return}await g({username:e,ipAddress:"unknown",userAgent:"unknown",isSuccess:!0});let k={id:i.data.userInfo.id,name:i.data.userInfo.name,username:i.data.userInfo.usernameId,email:i.data.userInfo.email,avatar:i.data.userInfo.avatar||"https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=100&h=100&fit=crop",bio:"系统管理员",role:i.data.userInfo.role,createdAt:new Date().toISOString()};h.adminAuth.login(k,i.data.token),a.push("/admin")}catch(a){console.error("登录失败:",a),o({message:"登录失败，请重试"}),await g({username:e,ipAddress:"unknown",userAgent:"unknown",isSuccess:!1,errorMessage:"系统错误"})}finally{q(!1)}};return(0,b.jsx)("div",{className:"min-h-[calc(100vh-200px)] flex items-center justify-center py-12 px-4 sm:px-6 lg:px-8",children:(0,b.jsxs)("div",{className:"max-w-md w-full space-y-8",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h2",{className:"mt-6 text-center text-3xl font-extrabold text-gray-900",children:r?"管理员登录":"访问验证"}),(0,b.jsx)("p",{className:"mt-2 text-center text-sm text-gray-600",children:r?"请输入管理员账号、密码和秘钥":"请输入访问密码"})]}),n.message&&(0,b.jsx)("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-md",children:n.message}),r?(0,b.jsxs)("form",{className:"mt-8 space-y-6",onSubmit:t,children:[(0,b.jsxs)("div",{className:"rounded-md -space-y-px",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{htmlFor:"username",className:"sr-only",children:"用户名"}),(0,b.jsx)("input",{id:"username",name:"username",type:"text",autoComplete:"username",required:!0,className:"appearance-none rounded-none relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-t-md focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm",placeholder:"用户名",value:e,onChange:a=>i(a.target.value)})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{htmlFor:"password",className:"sr-only",children:"密码"}),(0,b.jsx)("input",{id:"password",name:"password",type:"password",autoComplete:"current-password",required:!0,className:"appearance-none rounded-none relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm",placeholder:"密码",value:j,onChange:a=>k(a.target.value)})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{htmlFor:"secretKey",className:"sr-only",children:"管理员秘钥"}),(0,b.jsx)("input",{id:"secretKey",name:"secretKey",type:"password",required:!0,className:"appearance-none rounded-b-md relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm",placeholder:"管理员秘钥",value:l,onChange:a=>m(a.target.value)})]})]}),(0,b.jsx)("div",{children:(0,b.jsx)("button",{type:"submit",disabled:p,className:"group relative w-full flex justify-center py-2 px-4 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors disabled:opacity-70 disabled:cursor-not-allowed",children:p?"登录中...":"登录"})})]}):(0,b.jsxs)("form",{className:"mt-8 space-y-6",onSubmit:a=>{a.preventDefault(),"admin-portal"===new FormData(a.currentTarget).get("initialPassword")?s(!0):(g({username:"unknown",ipAddress:"unknown",userAgent:"unknown",isSuccess:!1,errorMessage:"初始密码错误"}),o({message:"访问被拒绝"}))},children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{htmlFor:"initialPassword",className:"sr-only",children:"访问密码"}),(0,b.jsx)("input",{id:"initialPassword",name:"initialPassword",type:"password",required:!0,className:"appearance-none relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-md focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm",placeholder:"请输入访问密码"})]}),(0,b.jsx)("div",{children:(0,b.jsx)("button",{type:"submit",className:"group relative w-full flex justify-center py-2 px-4 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors",children:"验证访问"})})]})]})})}a.s(["default",()=>i],69899)}];

//# sourceMappingURL=src_app_admin_secret-login_page_tsx_40e38c59._.js.map