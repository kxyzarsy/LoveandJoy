module.exports=[93695,(e,t,r)=>{t.exports=e.x("next/dist/shared/lib/no-fallback-error.external.js",()=>require("next/dist/shared/lib/no-fallback-error.external.js"))},70406,(e,t,r)=>{t.exports=e.x("next/dist/compiled/@opentelemetry/api",()=>require("next/dist/compiled/@opentelemetry/api"))},18622,(e,t,r)=>{t.exports=e.x("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js"))},56704,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},32319,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},24725,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/after-task-async-storage.external.js",()=>require("next/dist/server/app-render/after-task-async-storage.external.js"))},24361,(e,t,r)=>{t.exports=e.x("util",()=>require("util"))},14747,(e,t,r)=>{t.exports=e.x("path",()=>require("path"))},27699,(e,t,r)=>{t.exports=e.x("events",()=>require("events"))},92509,(e,t,r)=>{t.exports=e.x("url",()=>require("url"))},6461,(e,t,r)=>{t.exports=e.x("zlib",()=>require("zlib"))},88947,(e,t,r)=>{t.exports=e.x("stream",()=>require("stream"))},4446,(e,t,r)=>{t.exports=e.x("net",()=>require("net"))},54799,(e,t,r)=>{t.exports=e.x("crypto",()=>require("crypto"))},55004,(e,t,r)=>{t.exports=e.x("tls",()=>require("tls"))},22734,(e,t,r)=>{t.exports=e.x("fs",()=>require("fs"))},77823,e=>{"use strict";var t=e.i(47909),r=e.i(74017),s=e.i(96250),a=e.i(59756),n=e.i(61916),o=e.i(14444),i=e.i(37092),l=e.i(69741),u=e.i(16795),p=e.i(87718),c=e.i(95169),d=e.i(47587),x=e.i(66012),h=e.i(70101),m=e.i(74838),g=e.i(10372),f=e.i(93695);e.i(52474);var v=e.i(220),R=e.i(89171),E=e.i(29508);let y={"163.com":{service:"163",host:"smtp.163.com",port:465,secure:!0,auth:{user:process.env.EMAIL_163_USER||"your-email@163.com",pass:process.env.EMAIL_163_PASS||"BM5YWbFScfXxEuyD"}},"qq.com":{service:"qq",host:"smtp.qq.com",port:465,secure:!0,auth:{user:process.env.EMAIL_QQ_USER||"your-email@qq.com",pass:process.env.EMAIL_QQ_PASS||"wxjhixyhgmnechgg"}}},w=async(e,t,r="注册验证码")=>{try{let s,a=e.split("@")[1];"163.com"===a||"126.com"===a||"yeah.net"===a?(process.env.EMAIL_163_USER,s="163.com"):(process.env.EMAIL_QQ_USER,s="qq.com");let n=y[s];if(!n)throw Error(`未找到${s}的邮箱配置`);let o={...n,auth:{user:"163.com"===s?process.env.EMAIL_163_USER||n.auth.user:process.env.EMAIL_QQ_USER||n.auth.user,pass:"163.com"===s?process.env.EMAIL_163_PASS||n.auth.pass:process.env.EMAIL_QQ_PASS||n.auth.pass}};if(!o.auth.user||!o.auth.pass)throw Error("邮件配置不完整，请检查环境变量");let i=E.default.createTransport(o);try{await i.verify()}catch(e){throw console.error("SMTP连接验证失败:",e),Error(`SMTP连接验证失败: ${e instanceof Error?e.message:"未知错误"}`)}let l={from:{name:"Love and Joy Blog",address:o.auth.user},to:e,subject:r,html:`
        <div style="font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto; padding: 20px;">
          <h2 style="color: #333; text-align: center;">注册验证码</h2>
          <div style="background: #f8f9fa; padding: 30px; border-radius: 8px; margin: 20px 0;">
            <p style="font-size: 16px; color: #555; margin-bottom: 20px;">您好，</p>
            <p style="font-size: 16px; color: #555; margin-bottom: 20px;">您正在注册 Love and Joy Blog 账户，您的验证码是：</p>
            <div style="text-align: center; margin: 30px 0;">
              <span style="font-size: 32px; font-weight: bold; color: #1a73e8; letter-spacing: 4px;">${t}</span>
            </div>
            <p style="font-size: 14px; color: #666; margin-top: 30px;">验证码有效期为30分钟，请尽快使用。</p>
            <p style="font-size: 14px; color: #666; margin-top: 10px;">如果您没有请求此验证码，请忽略此邮件。</p>
          </div>
          <p style="font-size: 12px; color: #999; text-align: center;">\xa9 2024 Love and Joy Blog. All rights reserved.</p>
        </div>
      `};return await i.sendMail(l),{success:!0,message:"邮件发送成功"}}catch(t){console.error("邮件发送失败:",t);let e="邮件发送失败，请稍后重试";return t instanceof Error&&(e=t.message.includes("authentication failed")?"邮件发送失败：认证失败，请检查邮箱和授权码是否正确":t.message.includes("Invalid login")?"邮件发送失败：登录失败，请检查邮箱和授权码是否正确":`邮件发送失败：${t.message}`),{success:!1,message:e}}},A=new Map;async function _(e){try{let{email:t}=await e.json();if(!t||!/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/.test(t))return R.NextResponse.json({success:!1,message:"请输入有效的邮箱地址"},{status:400});let r=A.get(t),s=Date.now();if(r){if(s-(r.expiresAt-18e5)<6e4)return R.NextResponse.json({success:!1,message:"发送过于频繁，请稍后再试"},{status:429});if(r.attempts>=5&&s-(r.expiresAt-18e5)<36e5)return R.NextResponse.json({success:!1,message:"验证码发送次数过多，请1小时后再试"},{status:429})}let a=Math.floor(1e5+9e5*Math.random()).toString(),n=await w(t,a);if(!n.success)return R.NextResponse.json({success:!1,message:n.message},{status:500});return A.set(t,{code:a,expiresAt:s+18e5,attempts:r?r.attempts+1:1}),setTimeout(()=>{A.delete(t)},18e5),R.NextResponse.json({success:!0,message:"验证码已发送到您的邮箱，请查收",cooldown:6e4})}catch(e){return console.error("发送验证码失败:",e),R.NextResponse.json({success:!1,message:"发送验证码失败，请稍后重试"},{status:500})}}async function q(e){try{let t=new URL(e.url),r=t.searchParams.get("email"),s=t.searchParams.get("code");if(!r||!s)return R.NextResponse.json({success:!1,message:"缺少必要参数"},{status:400});let a=A.get(r),n=Date.now();if(!a)return R.NextResponse.json({success:!1,message:"验证码不存在或已过期"},{status:400});if(n>a.expiresAt)return A.delete(r),R.NextResponse.json({success:!1,message:"验证码已过期，请重新获取"},{status:400});if(a.code!==s)return R.NextResponse.json({success:!1,message:"验证码错误"},{status:400});return A.delete(r),R.NextResponse.json({success:!0,message:"验证码验证成功"})}catch(e){return console.error("验证验证码失败:",e),R.NextResponse.json({success:!1,message:"验证验证码失败，请稍后重试"},{status:500})}}e.s(["GET",()=>q,"POST",()=>_],57288);var S=e.i(57288);let b=new t.AppRouteRouteModule({definition:{kind:r.RouteKind.APP_ROUTE,page:"/api/auth/send-verification-code/route",pathname:"/api/auth/send-verification-code",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/src/app/api/auth/send-verification-code/route.ts",nextConfigOutput:"",userland:S}),{workAsyncStorage:C,workUnitAsyncStorage:N,serverHooks:M}=b;function P(){return(0,s.patchFetch)({workAsyncStorage:C,workUnitAsyncStorage:N})}async function j(e,t,s){b.isDev&&(0,a.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let R="/api/auth/send-verification-code/route";R=R.replace(/\/index$/,"")||"/";let E=await b.prepare(e,t,{srcPage:R,multiZoneDraftMode:!1});if(!E)return t.statusCode=400,t.end("Bad Request"),null==s.waitUntil||s.waitUntil.call(s,Promise.resolve()),null;let{buildId:y,params:w,nextConfig:A,parsedUrl:_,isDraftMode:q,prerenderManifest:S,routerServerContext:C,isOnDemandRevalidate:N,revalidateOnlyGenerated:M,resolvedPathname:P,clientReferenceManifest:j,serverActionsManifest:T}=E,I=(0,l.normalizeAppPath)(R),U=!!(S.dynamicRoutes[I]||S.routes[P]),k=async()=>((null==C?void 0:C.render404)?await C.render404(e,t,_,!1):t.end("This page could not be found"),null);if(U&&!q){let e=!!S.routes[P],t=S.dynamicRoutes[I];if(t&&!1===t.fallback&&!e){if(A.experimental.adapterPath)return await k();throw new f.NoFallbackError}}let O=null;!U||b.isDev||q||(O="/index"===(O=P)?"/":O);let L=!0===b.isDev||!U,H=U&&!L;T&&j&&(0,o.setReferenceManifestsSingleton)({page:R,clientReferenceManifest:j,serverActionsManifest:T,serverModuleMap:(0,i.createServerModuleMap)({serverActionsManifest:T})});let D=e.method||"GET",$=(0,n.getTracer)(),z=$.getActiveScopeSpan(),Q={params:w,prerenderManifest:S,renderOpts:{experimental:{authInterrupts:!!A.experimental.authInterrupts},cacheComponents:!!A.cacheComponents,supportsDynamicResponse:L,incrementalCache:(0,a.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:A.cacheLife,waitUntil:s.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,r,s)=>b.onRequestError(e,t,s,C)},sharedContext:{buildId:y}},B=new u.NodeNextRequest(e),F=new u.NodeNextResponse(t),K=p.NextRequestAdapter.fromNodeNextRequest(B,(0,p.signalFromNodeResponse)(t));try{let o=async e=>b.handle(K,Q).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let r=$.getRootSpanAttributes();if(!r)return;if(r.get("next.span_type")!==c.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${r.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let s=r.get("next.route");if(s){let t=`${D} ${s}`;e.setAttributes({"next.route":s,"http.route":s,"next.span_name":t}),e.updateName(t)}else e.updateName(`${D} ${R}`)}),i=!!(0,a.getRequestMeta)(e,"minimalMode"),l=async a=>{var n,l;let u=async({previousCacheEntry:r})=>{try{if(!i&&N&&M&&!r)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let n=await o(a);e.fetchMetrics=Q.renderOpts.fetchMetrics;let l=Q.renderOpts.pendingWaitUntil;l&&s.waitUntil&&(s.waitUntil(l),l=void 0);let u=Q.renderOpts.collectedTags;if(!U)return await (0,x.sendResponse)(B,F,n,Q.renderOpts.pendingWaitUntil),null;{let e=await n.blob(),t=(0,h.toNodeOutgoingHttpHeaders)(n.headers);u&&(t[g.NEXT_CACHE_TAGS_HEADER]=u),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let r=void 0!==Q.renderOpts.collectedRevalidate&&!(Q.renderOpts.collectedRevalidate>=g.INFINITE_CACHE)&&Q.renderOpts.collectedRevalidate,s=void 0===Q.renderOpts.collectedExpire||Q.renderOpts.collectedExpire>=g.INFINITE_CACHE?void 0:Q.renderOpts.collectedExpire;return{value:{kind:v.CachedRouteKind.APP_ROUTE,status:n.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:r,expire:s}}}}catch(t){throw(null==r?void 0:r.isStale)&&await b.onRequestError(e,t,{routerKind:"App Router",routePath:R,routeType:"route",revalidateReason:(0,d.getRevalidateReason)({isStaticGeneration:H,isOnDemandRevalidate:N})},C),t}},p=await b.handleResponse({req:e,nextConfig:A,cacheKey:O,routeKind:r.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:S,isRoutePPREnabled:!1,isOnDemandRevalidate:N,revalidateOnlyGenerated:M,responseGenerator:u,waitUntil:s.waitUntil,isMinimalMode:i});if(!U)return null;if((null==p||null==(n=p.value)?void 0:n.kind)!==v.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==p||null==(l=p.value)?void 0:l.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});i||t.setHeader("x-nextjs-cache",N?"REVALIDATED":p.isMiss?"MISS":p.isStale?"STALE":"HIT"),q&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let c=(0,h.fromNodeOutgoingHttpHeaders)(p.value.headers);return i&&U||c.delete(g.NEXT_CACHE_TAGS_HEADER),!p.cacheControl||t.getHeader("Cache-Control")||c.get("Cache-Control")||c.set("Cache-Control",(0,m.getCacheControlHeader)(p.cacheControl)),await (0,x.sendResponse)(B,F,new Response(p.value.body,{headers:c,status:p.value.status||200})),null};z?await l(z):await $.withPropagatedContext(e.headers,()=>$.trace(c.BaseServerSpan.handleRequest,{spanName:`${D} ${R}`,kind:n.SpanKind.SERVER,attributes:{"http.method":D,"http.target":e.url}},l))}catch(t){if(t instanceof f.NoFallbackError||await b.onRequestError(e,t,{routerKind:"App Router",routePath:I,routeType:"route",revalidateReason:(0,d.getRevalidateReason)({isStaticGeneration:H,isOnDemandRevalidate:N})}),U)throw t;return await (0,x.sendResponse)(B,F,new Response(null,{status:500})),null}}e.s(["handler",()=>j,"patchFetch",()=>P,"routeModule",()=>b,"serverHooks",()=>M,"workAsyncStorage",()=>C,"workUnitAsyncStorage",()=>N],77823)}];

//# sourceMappingURL=%5Broot-of-the-server%5D__ff5567a7._.js.map