module.exports=[93695,(e,t,r)=>{t.exports=e.x("next/dist/shared/lib/no-fallback-error.external.js",()=>require("next/dist/shared/lib/no-fallback-error.external.js"))},70406,(e,t,r)=>{t.exports=e.x("next/dist/compiled/@opentelemetry/api",()=>require("next/dist/compiled/@opentelemetry/api"))},18622,(e,t,r)=>{t.exports=e.x("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js"))},56704,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},32319,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},24725,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/after-task-async-storage.external.js",()=>require("next/dist/server/app-render/after-task-async-storage.external.js"))},24361,(e,t,r)=>{t.exports=e.x("util",()=>require("util"))},14747,(e,t,r)=>{t.exports=e.x("path",()=>require("path"))},88947,(e,t,r)=>{t.exports=e.x("stream",()=>require("stream"))},54799,(e,t,r)=>{t.exports=e.x("crypto",()=>require("crypto"))},27699,(e,t,r)=>{t.exports=e.x("events",()=>require("events"))},4446,(e,t,r)=>{t.exports=e.x("net",()=>require("net"))},55004,(e,t,r)=>{t.exports=e.x("tls",()=>require("tls"))},6461,(e,t,r)=>{t.exports=e.x("zlib",()=>require("zlib"))},92509,(e,t,r)=>{t.exports=e.x("url",()=>require("url"))},22734,(e,t,r)=>{t.exports=e.x("fs",()=>require("fs"))},75343,(e,t,r)=>{t.exports=e.x("bcrypt",()=>require("bcrypt"))},36170,e=>{"use strict";let t={logLevel:"INFO",maxFileSize:0xa00000,backupCount:5,logDirectory:"logs",enableConsoleLogging:!0,enableFileLogging:!0},r=e=>{let t=`${e.timestamp} [${e.level}] [${e.type}] [${e.action}] [${e.status}]`,r=e.userId?` [User: ${e.userId} (${e.username||"N/A"})]`:"",a=e.requestId?` [Request: ${e.requestId}]`:"",s=e.resource?` [Resource: ${e.resource}]`:"",i=` [IP: ${e.ipAddress}]`,o=e.details?` Details: ${JSON.stringify(e.details)}`:"";return`${t}${r}${a}${s}${i} - ${e.message}${o}`},a=new class{config;logQueue=[];flushInterval=null;constructor(e){this.config={...t,...e},this.initLogDirectory(),this.flushInterval=setInterval(()=>{this.flushLogQueue()},5e3)}initLogDirectory(){if(this.config.enableFileLogging)try{{let t=e.r(22734),r=e.r(14747).join(process.cwd(),this.config.logDirectory);t.existsSync(r)||t.mkdirSync(r,{recursive:!0})}}catch(e){console.error("Failed to initialize log directory:",e)}}log(e,t,r,a){var s;let i;if(s=this.config.logLevel,!((i=["DEBUG","INFO","WARN","ERROR","CRITICAL","SECURITY"]).indexOf(e)>=i.indexOf(s)))return;let o={id:Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15),timestamp:new Date().toISOString(),level:e,type:t,message:r,...a};this.logQueue.push(o),this.config.enableConsoleLogging&&this.logToConsole(o),["ERROR","CRITICAL","SECURITY"].includes(e)&&this.flushLogQueue()}logToConsole(e){let t=r(e);switch(e.level){case"DEBUG":console.debug(t);break;case"INFO":console.info(t);break;case"WARN":console.warn(t);break;case"ERROR":case"SECURITY":console.error(t);break;case"CRITICAL":console.error("\x1b[31m"+t+"\x1b[0m");break;default:console.log(t)}}async logToFile(t){if(this.config.enableFileLogging)try{{let a=e.r(22734),s=e.r(14747),i=new Date().toISOString().split("T")[0],o=`${i}-${t.type.toLowerCase()}.log`,n=s.join(process.cwd(),this.config.logDirectory,o),l=r(t)+"\n";a.appendFileSync(n,l,"utf8"),this.checkAndRotateLogs(n)}}catch(e){console.error("Failed to write log to file:",e)}}checkAndRotateLogs(t){try{{let r=e.r(22734),a=e.r(14747);if(r.statSync(t).size>this.config.maxFileSize){let e=`${t}.${Date.now()}`;r.renameSync(t,e),r.writeFileSync(t,"","utf8"),this.cleanupOldBackups(a.dirname(t),a.basename(t))}}}catch(e){console.error("Failed to rotate logs:",e)}}cleanupOldBackups(t,r){try{{let a=e.r(22734),s=e.r(14747),i=a.readdirSync(t).filter(e=>e.startsWith(r)&&e!==r).map(e=>s.join(t,e)).sort((e,t)=>a.statSync(e).mtime.getTime()-a.statSync(t).mtime.getTime());for(;i.length>this.config.backupCount;){let e=i.shift();e&&a.unlinkSync(e)}}}catch(e){console.error("Failed to cleanup old backups:",e)}}flushLogQueue(){if(0===this.logQueue.length)return;let e=[...this.logQueue];this.logQueue=[],e.forEach(e=>{this.logToFile(e).catch(e=>{console.error("Failed to write log:",e)})})}logAuthentication(e,t){this.log("FAILURE"===t.status?"SECURITY":"INFO","AUTHENTICATION",e,t)}logAuthorization(e,t){this.log("FAILURE"===t.status?"SECURITY":"INFO","AUTHORIZATION",e,t)}logApiCall(e,t){this.log("FAILURE"===t.status?"ERROR":"INFO","API_CALL",e,t)}logSecurityViolation(e,t){this.log("SECURITY","SECURITY_VIOLATION",e,{...t,status:"FAILURE"})}close(){this.flushInterval&&(clearInterval(this.flushInterval),this.flushInterval=null),this.flushLogQueue()}};e.s(["securityLogger",0,a])},30450,e=>{"use strict";var t=e.i(47909),r=e.i(74017),a=e.i(96250),s=e.i(59756),i=e.i(61916),o=e.i(14444),n=e.i(37092),l=e.i(69741),u=e.i(16795),c=e.i(87718),d=e.i(95169),p=e.i(47587),g=e.i(66012),h=e.i(70101),R=e.i(74838),x=e.i(10372),f=e.i(93695);e.i(52474);var m=e.i(220),E=e.i(89171),I=e.i(24652),v=e.i(75343),y=e.i(69719),w=e.i(12080),A=e.i(37741),C=e.i(36170);let S=y.z.object({email:y.z.string().email("请输入有效的邮箱地址"),password:y.z.string().min(6,"密码长度不能少于6个字符")});async function T(e){let t=e.headers.get("x-forwarded-for")||"unknown",r=e.headers.get("user-agent")||"unknown";return(0,A.handleApiError)(async()=>{var a,s,i;let o,n=await e.json(),{email:l,password:u}=S.parse(n),[c]=await (0,w.executeQuery)("SELECT id, name, email, password, usernameId, avatar, role FROM user WHERE email = ?",[l]);if(0===c.length)throw C.securityLogger.logAuthentication("登录失败：用户不存在",{ipAddress:t,userAgent:r,action:"LOGIN",status:"FAILURE",details:{email:l}}),new A.AppError(A.ErrorCode.AUTHENTICATION_ERROR,"账号不存在");let d=c[0],p=!1;if(d.password.startsWith("$2b$"))p=await v.default.compare(u,d.password);else if(p=u===d.password){let e=await v.default.hash(u,10);await (0,w.executeQuery)("UPDATE user SET password = ? WHERE id = ?",[e,d.id])}if(!p)throw C.securityLogger.logAuthentication("登录失败：密码错误",{userId:d.id.toString(),username:d.name,ipAddress:t,userAgent:r,action:"LOGIN",status:"FAILURE",details:{email:l}}),new A.AppError(A.ErrorCode.AUTHENTICATION_ERROR,"密码错误");await (0,w.executeQuery)("UPDATE user SET lastLoginAt = NOW() WHERE id = ?",[d.id]);let g=(a=d.id,s=d.email,i=d.role,o=process.env.JWT_SECRET||"your-secret-key",I.default.sign({userId:a,email:s,role:i},o,{expiresIn:"2h"})),h={id:d.id,name:d.name,email:d.email,usernameId:d.usernameId,avatar:d.avatar,role:d.role};return C.securityLogger.logAuthentication("登录成功",{userId:d.id.toString(),username:d.name,ipAddress:t,userAgent:r,action:"LOGIN",status:"SUCCESS",details:{email:l,role:d.role}}),C.securityLogger.logApiCall("登录API调用成功",{userId:d.id.toString(),username:d.name,ipAddress:t,userAgent:r,action:"POST",resource:"/api/auth/login",status:"SUCCESS",details:{email:l}}),E.NextResponse.json({success:!0,data:{token:g,userInfo:h},message:"登录成功"},{status:200})})}e.s(["POST",()=>T],11615);var O=e.i(11615);let b=new t.AppRouteRouteModule({definition:{kind:r.RouteKind.APP_ROUTE,page:"/api/auth/login/route",pathname:"/api/auth/login",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/src/app/api/auth/login/route.ts",nextConfigOutput:"",userland:O}),{workAsyncStorage:N,workUnitAsyncStorage:L,serverHooks:U}=b;function k(){return(0,a.patchFetch)({workAsyncStorage:N,workUnitAsyncStorage:L})}async function F(e,t,a){b.isDev&&(0,s.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let E="/api/auth/login/route";E=E.replace(/\/index$/,"")||"/";let I=await b.prepare(e,t,{srcPage:E,multiZoneDraftMode:!1});if(!I)return t.statusCode=400,t.end("Bad Request"),null==a.waitUntil||a.waitUntil.call(a,Promise.resolve()),null;let{buildId:v,params:y,nextConfig:w,parsedUrl:A,isDraftMode:C,prerenderManifest:S,routerServerContext:T,isOnDemandRevalidate:O,revalidateOnlyGenerated:N,resolvedPathname:L,clientReferenceManifest:U,serverActionsManifest:k}=I,F=(0,l.normalizeAppPath)(E),q=!!(S.dynamicRoutes[F]||S.routes[L]),$=async()=>((null==T?void 0:T.render404)?await T.render404(e,t,A,!1):t.end("This page could not be found"),null);if(q&&!C){let e=!!S.routes[L],t=S.dynamicRoutes[F];if(t&&!1===t.fallback&&!e){if(w.experimental.adapterPath)return await $();throw new f.NoFallbackError}}let P=null;!q||b.isDev||C||(P="/index"===(P=L)?"/":P);let D=!0===b.isDev||!q,_=q&&!D;k&&U&&(0,o.setReferenceManifestsSingleton)({page:E,clientReferenceManifest:U,serverActionsManifest:k,serverModuleMap:(0,n.createServerModuleMap)({serverActionsManifest:k})});let H=e.method||"GET",j=(0,i.getTracer)(),M=j.getActiveScopeSpan(),Q={params:y,prerenderManifest:S,renderOpts:{experimental:{authInterrupts:!!w.experimental.authInterrupts},cacheComponents:!!w.cacheComponents,supportsDynamicResponse:D,incrementalCache:(0,s.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:w.cacheLife,waitUntil:a.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,r,a)=>b.onRequestError(e,t,a,T)},sharedContext:{buildId:v}},z=new u.NodeNextRequest(e),W=new u.NodeNextResponse(t),B=c.NextRequestAdapter.fromNodeNextRequest(z,(0,c.signalFromNodeResponse)(t));try{let o=async e=>b.handle(B,Q).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let r=j.getRootSpanAttributes();if(!r)return;if(r.get("next.span_type")!==d.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${r.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let a=r.get("next.route");if(a){let t=`${H} ${a}`;e.setAttributes({"next.route":a,"http.route":a,"next.span_name":t}),e.updateName(t)}else e.updateName(`${H} ${E}`)}),n=!!(0,s.getRequestMeta)(e,"minimalMode"),l=async s=>{var i,l;let u=async({previousCacheEntry:r})=>{try{if(!n&&O&&N&&!r)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let i=await o(s);e.fetchMetrics=Q.renderOpts.fetchMetrics;let l=Q.renderOpts.pendingWaitUntil;l&&a.waitUntil&&(a.waitUntil(l),l=void 0);let u=Q.renderOpts.collectedTags;if(!q)return await (0,g.sendResponse)(z,W,i,Q.renderOpts.pendingWaitUntil),null;{let e=await i.blob(),t=(0,h.toNodeOutgoingHttpHeaders)(i.headers);u&&(t[x.NEXT_CACHE_TAGS_HEADER]=u),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let r=void 0!==Q.renderOpts.collectedRevalidate&&!(Q.renderOpts.collectedRevalidate>=x.INFINITE_CACHE)&&Q.renderOpts.collectedRevalidate,a=void 0===Q.renderOpts.collectedExpire||Q.renderOpts.collectedExpire>=x.INFINITE_CACHE?void 0:Q.renderOpts.collectedExpire;return{value:{kind:m.CachedRouteKind.APP_ROUTE,status:i.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:r,expire:a}}}}catch(t){throw(null==r?void 0:r.isStale)&&await b.onRequestError(e,t,{routerKind:"App Router",routePath:E,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:_,isOnDemandRevalidate:O})},T),t}},c=await b.handleResponse({req:e,nextConfig:w,cacheKey:P,routeKind:r.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:S,isRoutePPREnabled:!1,isOnDemandRevalidate:O,revalidateOnlyGenerated:N,responseGenerator:u,waitUntil:a.waitUntil,isMinimalMode:n});if(!q)return null;if((null==c||null==(i=c.value)?void 0:i.kind)!==m.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==c||null==(l=c.value)?void 0:l.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});n||t.setHeader("x-nextjs-cache",O?"REVALIDATED":c.isMiss?"MISS":c.isStale?"STALE":"HIT"),C&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let d=(0,h.fromNodeOutgoingHttpHeaders)(c.value.headers);return n&&q||d.delete(x.NEXT_CACHE_TAGS_HEADER),!c.cacheControl||t.getHeader("Cache-Control")||d.get("Cache-Control")||d.set("Cache-Control",(0,R.getCacheControlHeader)(c.cacheControl)),await (0,g.sendResponse)(z,W,new Response(c.value.body,{headers:d,status:c.value.status||200})),null};M?await l(M):await j.withPropagatedContext(e.headers,()=>j.trace(d.BaseServerSpan.handleRequest,{spanName:`${H} ${E}`,kind:i.SpanKind.SERVER,attributes:{"http.method":H,"http.target":e.url}},l))}catch(t){if(t instanceof f.NoFallbackError||await b.onRequestError(e,t,{routerKind:"App Router",routePath:F,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:_,isOnDemandRevalidate:O})}),q)throw t;return await (0,g.sendResponse)(z,W,new Response(null,{status:500})),null}}e.s(["handler",()=>F,"patchFetch",()=>k,"routeModule",()=>b,"serverHooks",()=>U,"workAsyncStorage",()=>N,"workUnitAsyncStorage",()=>L],30450)}];

//# sourceMappingURL=%5Broot-of-the-server%5D__666f015d._.js.map