(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,32636,e=>{"use strict";var r=e.i(43476),s=e.i(71645),a=e.i(18566),t=e.i(47167);async function n(){try{return t.default.env.ADMIN_SECRET||"default-secret-key"}catch(e){return console.error("获取当前秘钥失败:",e),null}}async function o(e){try{let r=await n();return e===r}catch(e){return console.error("验证秘钥失败:",e),!1}}async function i(e){}var l=e.i(89001);function d(){let e=(0,a.useRouter)(),[t,n]=(0,s.useState)(""),[d,u]=(0,s.useState)(""),[c,m]=(0,s.useState)(""),[p,g]=(0,s.useState)({}),[h,f]=(0,s.useState)(!1),[x,b]=(0,s.useState)(!1),y=async r=>{r.preventDefault(),f(!0),g({});try{if(await i({username:t,ipAddress:window.location.hostname,userAgent:navigator.userAgent,isSuccess:!1}),!await o(c)){await i({username:t,ipAddress:window.location.hostname,userAgent:navigator.userAgent,isSuccess:!1,errorMessage:"管理员秘钥错误"}),g({message:"管理员秘钥错误"});return}let r=/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t),s={};if(r)s={email:t,password:d};else try{let e=await fetch(`/api/users?usernameId=${t}`),r=await e.json();if(r.length>0)s={email:r[0].email,password:d};else{await i({username:t,ipAddress:window.location.hostname,userAgent:navigator.userAgent,isSuccess:!1,errorMessage:"用户名不存在"}),g({message:"用户名不存在"});return}}catch(e){console.error("查询用户邮箱失败:",e),g({message:"登录失败，请重试"});return}let a=await fetch("/api/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)}),n=await a.json();if(!a.ok||!n.success){await i({username:t,ipAddress:window.location.hostname,userAgent:navigator.userAgent,isSuccess:!1,errorMessage:n.message||"用户名或密码错误"}),g({message:n.message||"用户名或密码错误"});return}await i({username:t,ipAddress:window.location.hostname,userAgent:navigator.userAgent,isSuccess:!0});let u={id:n.data.userInfo.id,name:n.data.userInfo.name,username:n.data.userInfo.usernameId,email:n.data.userInfo.email,avatar:n.data.userInfo.avatar||"https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=100&h=100&fit=crop",bio:"系统管理员",role:n.data.userInfo.role,createdAt:new Date().toISOString()};l.adminAuth.login(u,n.data.token),e.push("/admin")}catch(e){console.error("登录失败:",e),g({message:"登录失败，请重试"}),await i({username:t,ipAddress:window.location.hostname,userAgent:navigator.userAgent,isSuccess:!1,errorMessage:"系统错误"})}finally{f(!1)}};return(0,r.jsx)("div",{className:"min-h-[calc(100vh-200px)] flex items-center justify-center py-12 px-4 sm:px-6 lg:px-8",children:(0,r.jsxs)("div",{className:"max-w-md w-full space-y-8",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h2",{className:"mt-6 text-center text-3xl font-extrabold text-gray-900",children:x?"管理员登录":"访问验证"}),(0,r.jsx)("p",{className:"mt-2 text-center text-sm text-gray-600",children:x?"请输入管理员账号、密码和秘钥":"请输入访问密码"})]}),p.message&&(0,r.jsx)("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-md",children:p.message}),x?(0,r.jsxs)("form",{className:"mt-8 space-y-6",onSubmit:y,children:[(0,r.jsxs)("div",{className:"rounded-md -space-y-px",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"username",className:"sr-only",children:"用户名"}),(0,r.jsx)("input",{id:"username",name:"username",type:"text",autoComplete:"username",required:!0,className:"appearance-none rounded-none relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-t-md focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm",placeholder:"用户名",value:t,onChange:e=>n(e.target.value)})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"password",className:"sr-only",children:"密码"}),(0,r.jsx)("input",{id:"password",name:"password",type:"password",autoComplete:"current-password",required:!0,className:"appearance-none rounded-none relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm",placeholder:"密码",value:d,onChange:e=>u(e.target.value)})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"secretKey",className:"sr-only",children:"管理员秘钥"}),(0,r.jsx)("input",{id:"secretKey",name:"secretKey",type:"password",required:!0,className:"appearance-none rounded-b-md relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm",placeholder:"管理员秘钥",value:c,onChange:e=>m(e.target.value)})]})]}),(0,r.jsx)("div",{children:(0,r.jsx)("button",{type:"submit",disabled:h,className:"group relative w-full flex justify-center py-2 px-4 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors disabled:opacity-70 disabled:cursor-not-allowed",children:h?"登录中...":"登录"})})]}):(0,r.jsxs)("form",{className:"mt-8 space-y-6",onSubmit:e=>{e.preventDefault(),"admin-portal"===e.currentTarget.initialPassword.value?b(!0):(i({username:"unknown",ipAddress:window.location.hostname,userAgent:navigator.userAgent,isSuccess:!1,errorMessage:"初始密码错误"}),g({message:"访问被拒绝"}))},children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"initialPassword",className:"sr-only",children:"访问密码"}),(0,r.jsx)("input",{id:"initialPassword",name:"initialPassword",type:"password",required:!0,className:"appearance-none relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-md focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm",placeholder:"请输入访问密码"})]}),(0,r.jsx)("div",{children:(0,r.jsx)("button",{type:"submit",className:"group relative w-full flex justify-center py-2 px-4 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors",children:"验证访问"})})]})]})})}e.s(["default",()=>d],32636)}]);